# 形式化规范：超图模态重写系统 (Hypergraph Modal Rewriting,$HMR$)

## 1. 结构基座 (Structural Foundation)

**定义 1.1 (系统配置)**
$\text{SC-HMR}$ 由三元组 $\langle \mathcal{H}, \Sigma, \rho \rangle$ 定义：
1.  **超图架构**：$\mathcal{H} = (V, \mathcal{E})$，其中 $V$ 为节点集，$e \in \mathcal{E} \subseteq 2^V \setminus \{\emptyset\}$ 为定义理论共享范围的超边。
2.  **代数签名**：$\Sigma$ 为分级算子集，定义了项空间 $\mathcal{T}(\Sigma, \mathcal{X})$。
3.  **本原分布**：映射 $\rho: V \to \mathcal{P}(\mathcal{T}^2)$ 为每个节点分配初始的重写规则集。

## 2. 算子族与同余闭包 (Operators and Closures)

**定义 2.1 (对称同余算子)**
对于任意二元关系 $R \subseteq \mathcal{T}^2$，定义其生成的**对称同余闭包** $\mathbb{C}(R)$ 为满足以下条件的最小关系：
*   $R \subseteq \mathbb{C}(R)$ 且 $(t, s) \in R \implies (s, t) \in \mathbb{C}(R)$（包含性与对称性）。
*   $\forall f \in \Sigma, (t_i, s_i) \in \mathbb{C}(R) \implies f(\dots, t_i, \dots) \in \mathbb{C}(R) \dots f(\dots, s_i, \dots)$（同余性）。
*   $\mathbb{C}(R)$ 满足自反性与传递性（等价性）。

**定义 2.2 (超边理论投影)**
令 $\mathbf{R} = (R_v)_{v \in V}$ 为各节点的当前有效重写关系向量。定义超边 $e$ 诱导的**环境等式理论** $\theta_e$ 为：
$$ \theta_e(\mathbf{R}) \triangleq \mathbb{C}\left( \bigcup_{u \in e} R_u \right) $$
该算子将超边内所有节点的“动态重写”坍缩为该区域内的“静态对称等值”。

## 3. 递归语义构造 (Recursive Semantics)

系统的核心逻辑在于：节点 $v$ 的重写能力受限于其所处的所有超边理论的并集。

**定义 3.1 (模态算子)**
定义全局语义变换算子 $\Psi: (\mathcal{P}(\mathcal{T}^2))^V \to (\mathcal{P}(\mathcal{T}^2))^V$。对于节点 $v \in V$，其分量 $\Psi(\mathbf{R})_v$ 定义为：
$$ \Psi(\mathbf{R})_v \triangleq \left[ \bigcup_{e \in \eta(v)} \theta_e(\mathbf{R}) \right] \circ \rho(v) \circ \left[ \bigcup_{e \in \eta(v)} \theta_e(\mathbf{R}) \right] $$
其中 $\eta(v) = \{e \in \mathcal{E} \mid v \in e\}$，$\circ$ 为关系复合。

**定理 3.1 (语义存在性)**
在幂集格 $(\mathcal{P}(\mathcal{T}^2))^V$ 上，$\Psi$ 是单调的。由 Knaster-Tarski 定理可知，系统存在最小不动点 $\mathbf{R}^\infty = \text{lfp}(\Psi)$。

**定义 3.2 (最终重写谓词)**
节点 $v$ 处的有效重写关系 $\xrightarrow[v]{}$ 定义为不动点向量的第 $v$ 个分量：
$$ t \xrightarrow[v]{} s \iff (t, s) \in (\mathbf{R}^\infty)_v $$

---

## 4. 演绎系统：对称性扩散演算 (Symmetry Diffusion Calculus)

系统语义由以下相互递归的推导规则集合完全刻画。

### 层级 I：本原驱动 (Intrinsic Propulsion)
$$
\text{(Base)} \frac{(l, r) \in \rho(v)}{l \xrightarrow[v]{} r}
$$

### 层级 II：超边等化 (Hyperedge Equalization)
该层级将某一节点的“重写”视为其所属超边内的“等值”。
$$
\text{(Equal-Init)} \frac{t \xrightarrow[u]{} s \quad u \in e}{t \approx_e s}
$$
$$
\text{(Symm)} \frac{t \approx_e s}{s \approx_e t} \quad 
\text{(Trans)} \frac{t \approx_e u \quad u \approx_e s}{t \approx_e s} \quad
\text{(Refl)} \frac{}{t \approx_e t}
$$
$$
\text{(Cong)} \frac{t_1 \approx_e s_1 \dots t_n \approx_e s_n}{f(t_1, \dots, t_n) \approx_e f(s_1, \dots, s_n)}
$$

### 层级 III：模态重写 (Modal Rewriting)
该层级定义了节点如何利用超边的等值环境进行重写。
$$
\text{(Context)} \frac{t \approx_e s \quad v \in e}{t \equiv_v s} \quad
\text{(Global-Trans)} \frac{t \equiv_v u \quad u \equiv_v s}{t \equiv_v s}
$$
$$
\text{(Rewrite-Modulo)} \frac{t \equiv_v l \quad l \xrightarrow[v]{} r \quad r \equiv_v s}{t \xrightarrow[v]{} s}
$$

---

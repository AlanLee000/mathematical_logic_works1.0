### 变量展开与等价演算
#### **1. 语言 (Language)**

该形式语言由其字母表和合式公式的构造规则定义。

**1.1. 字母表 (Alphabet)**

1.  **命题变量集 (Set of Propositional Variables):** 一个可数的集合 $\mathcal{P} = \{p, q, r, p_0, p_1, \dots\}$。
2.  **二元联结词 (Binary Connectives):**
    *   $\equiv$  (等价)
    *   $\triangleright$ (展开)
3.  **辅助符号 (Auxiliary Symbols):**  $($, $)$

**1.2. 合式公式 (Well-formed Formulas - WFFs)**

合式公式的集合（记为 **WFF**）被递归地定义如下：

1.  **基础:** 如果 $\phi \in \mathcal{P}$，则 $\phi$ 是一个合式公式。
2.  **递归:** 如果 $\phi$ 和 $\psi$ 是合式公式，则 $(\phi \equiv \psi)$ 和 $(\phi \triangleright \psi)$ 也是合式公式。
3.  **封闭:** 只有通过有限次应用以上规则生成的表达式才是合式公式。

*注：为清晰起见，我们将省略最外层的括号。*

#### **2. 辅助定义：变量集函数 (Auxiliary Definition: Variable Set Function)**

为了陈述特殊的推理规则，我们定义一个函数 $var: \mathbf{WFF} \to 2^\mathcal{P}$，它返回一个公式中出现的所有命题变量的集合。

1.  **基础:** 对于任意命题变量 $p \in \mathcal{P}$，
    $var(p) = \{p\}$
2.  **递归:** 对于任意合式公式 $\phi, \psi$ 和任意二元联结词 $\circ \in \{\equiv, \triangleright\}$，
    $var((\phi \circ \psi)) = var(\phi) \cup var(\psi)$

#### **3. 公理模式 (Axiom Schemata)**

对于 **WFF** 中的任意公式 $A, B, C$，以下均为公理。

*   **A1: 等价的自反律 (Reflexivity of Equivalence)**
    $$
    A \equiv A
    $$

*   **A2: 展开的结合律 (Associativity of Expansion)**
    $$
    ((A \triangleright B) \triangleright C) \equiv (A \triangleright (B \triangleright C))
    $$

*   **A3: 混合结合律 (Mixed Associativity)**
    此公理模式包含两种形式，确保 $\equiv$ 和 $\triangleright$ 之间的结合性。
    1.  $((A \equiv B) \triangleright C) \equiv (A \equiv (B \triangleright C))$
    2.  $(A \triangleright (B \equiv C) ) \equiv ( (A \triangleright B) \equiv C)$

#### **4. 推理规则 (Inference Rules)**

设 $A, B, C, D, E$ 为任意合式公式。

*   **R1: 对称律 (Symmetry)**
    $$
    \frac{A \equiv B}{B \equiv A}
    $$

*   **R2: 传递律 (Transitivity)**
    $$
    \frac{A \equiv B, \quad B \equiv C}{A \equiv C}
    $$

*   **R3: 同余律 (Congruence)**
    对于任意二元联结词 $\circ \in \{\equiv, \triangleright\}$，此规则均适用。
    $$
    \frac{A \equiv B}{(A \circ C) \equiv (B \circ C)} \qquad \frac{A \equiv B}{(C \circ A) \equiv (C \circ B)}
    $$

*   **R4: 变量不交替换规则 (Variable-Disjoint Substitution Rule)**
    此规则基于公式的变量集进行约束。
    $$
    \frac
    { (A \triangleright B) \equiv C, \quad (D \triangleright B) \equiv E \quad \text{且} \quad var(A) = var(D), \quad var(A) \cap var(B) = \emptyset }
    { C \equiv E }
    $$

---

### **5. 系统一致性证明 (句法方法)**

本节将通过定义一个句法不变量来证明该形式系统的一致性。我们将证明所有可证定理都必须满足一个特定的句法属性，然后找出一个不满足该属性的合式公式，从而证明该公式不可证，进而证明系统是一致的。

#### **5.1. 句法不变量的定义**

**定义 5.1 (属性 $\mathcal{V}$):** 一个合式公式若具有 $A \equiv B$ 的形式，则称其**拥有属性 $\mathcal{V}$**，当且仅当 $var(A) = var(B)$。

#### **5.2. 定理的句法属性**

**引理 5.2:** 在此形式系统中，任何可被证明的定理（即任何形如 $A \equiv B$ 的公理或由推理规则导出的公式）都拥有属性 $\mathcal{V}$。

**证明:**
我们通过对证明的长度 $n$ 进行数学归纳来证明此引理。

**1. 基础情形 (n=1):**
当证明长度为1时，该定理本身就是一个公理。我们必须验证所有公理模式都满足属性 $\mathcal{V}$。

*   **A1 $A \equiv A$:**
    $var(A) = var(A)$ 依据集合等式的自反律成立。因此，A1拥有属性 $\mathcal{V}$。

*   **A2 $((A \triangleright B) \triangleright C) \equiv (A \triangleright (B \triangleright C))$:**
    *   $var(((A \triangleright B) \triangleright C)) = var(A \triangleright B) \cup var(C) = (var(A) \cup var(B)) \cup var(C)$.
    *   $var((A \triangleright (B \triangleright C))) = var(A) \cup var(B \triangleright C) = var(A) \cup (var(B) \cup var(C))$.
    *   依据集合并集的结合律，两者相等。因此，A2拥有属性 $\mathcal{V}$。

*   **A3.1 $((A \equiv B) \triangleright C) \equiv (A \equiv (B \triangleright C))$:**
    *   $var(((A \equiv B) \triangleright C)) = var(A \equiv B) \cup var(C) = (var(A) \cup var(B)) \cup var(C)$.
    *   $var((A \equiv (B \triangleright C))) = var(A) \cup var(B \triangleright C) = var(A) \cup (var(B) \cup var(C))$.
    *   依据集合并集的结合律，两者相等。因此，A3.1拥有属性 $\mathcal{V}$。

*   **A3.2 $(A \triangleright (B \equiv C)) \equiv ((A \triangleright B) \equiv C)$:**
    *   $var((A \triangleright (B \equiv C))) = var(A) \cup var(B \equiv C) = var(A) \cup (var(B) \cup var(C))$.
    *   $var(((A \triangleright B) \equiv C)) = var(A \triangleright B) \cup var(C) = (var(A) \cup var(B)) \cup var(C)$.
    *   依据集合并集的结合律，两者相等。因此，A3.2拥有属性 $\mathcal{V}$。

**2. 归纳步骤:**
归纳假设：所有可通过长度小于 $n$ 的证明得到的定理都拥有属性 $\mathcal{V}$。
现在，我们证明一个通过长度为 $n$ 的证明得到的定理也拥有属性 $\mathcal{V}$。这个定理必然是通过某个推理规则从一个或多个前提推导出来的，而这些前提的证明长度都小于 $n$。

*   **R1 (对称律):**
    前提为 $A \equiv B$。根据归纳假设，$var(A) = var(B)$。
    结论为 $B \equiv A$。由于 $var(B) = var(A)$ 依据集合等式的对称律成立，结论拥有属性 $\mathcal{V}$。

*   **R2 (传递律):**
    前提为 $A \equiv B$ 和 $B \equiv C$。根据归纳假设，$var(A) = var(B)$ 且 $var(B) = var(C)$。
    结论为 $A \equiv C$。由于 $var(A) = var(C)$ 依据集合等式的传递律成立，结论拥有属性 $\mathcal{V}$。

*   **R3 (同余律):**
    假设前提为 $A \equiv B$。根据归纳假设，$var(A) = var(B)$。
    *   对于结论 $(A \circ C) \equiv (B \circ C)$：
        $var(A \circ C) = var(A) \cup var(C)$。
        $var(B \circ C) = var(B) \cup var(C)$。
        因为 $var(A) = var(B)$，所以 $var(A) \cup var(C) = var(B) \cup var(C)$。结论拥有属性 $\mathcal{V}$。
    *   对于结论 $(C \circ A) \equiv (C \circ B)$，证明同理。

*   **R4 (变量不交替换规则):**
    前提为 $(A \triangleright B) \equiv C$ 和 $(D \triangleright B) \equiv E$，且满足句法条件 $var(A) = var(D)$ 和 $var(A) \cap var(B) = \emptyset$（此条件在这个证明中用不到）。
    根据归纳假设，前提拥有属性 $\mathcal{V}$：
    1.  $var(A \triangleright B) = var(C) \implies var(A) \cup var(B) = var(C)$。
    2.  $var(D \triangleright B) = var(E) \implies var(D) \cup var(B) = var(E)$。
    结论为 $C \equiv E$。我们需要证明 $var(C) = var(E)$。
    根据句法条件 $var(A) = var(D)$，我们可以将第二个等式改写为 $var(A) \cup var(B) = var(E)$。
    现在我们有 $var(C) = var(A) \cup var(B)$ 和 $var(E) = var(A) \cup var(B)$。
    因此，$var(C) = var(E)$。结论拥有属性 $\mathcal{V}$。

基础情形和归纳步骤均已证明。因此，通过数学归纳法，引理 5.2 成立。
**Q.E.D.**

#### **5.3. 一致性定理**

**定理 5.3:** 该形式系统是一致的。

**证明:**
一个形式系统是一致的，当且仅当存在至少一个合式公式不是该系统的定理。

1.  从命题变量集 $\mathcal{P}$ 中选取两个不同的变量，记为 $p$ 和 $q$，即 $p \neq q$。
2.  构造合式公式 $p \equiv q$。
3.  根据变量集函数的定义：
    *   $var(p) = \{p\}$
    *   $var(q) = \{q\}$
4.  由于 $p \neq q$，可知 $\{p\} \neq \{q\}$。因此，$var(p) \neq var(q)$。
5.  根据定义 5.1，公式 $p \equiv q$ 不拥有属性 $\mathcal{V}$。
6.  根据引理 5.2，所有该系统的定理都必须拥有属性 $\mathcal{V}$。
7.  因此，公式 $p \equiv q$ 不可能是该系统的一个定理。
8.  我们已经找到了一个不是定理的合式公式，故该系统不是不一致的。

所以，该形式系统是一致的。
**Q.E.D.**

---

### **6. 意向语义模型：结构代换系统 (Intended Semantic Model: A System of Structural Substitution)**

本节提供一个非形式化的意向模型，以阐明该形式系统的内在结构与设计动机。此模型将合式公式（WFFs）解释为描述结构化对象的蓝图，并将证明关系 $⊢ A ≡ B$ 解释为两个蓝图 $A$ 和 $B$ 在构造上产生等价对象的声明。

#### **6.1. 核心概念**

1.  **原子结构 (Atomic Structures):** 命题变量集 $\mathcal{P}$ 中的每个元素 $p, q, \dots$ 被视为一个基础的、不可再分的原子结构。它们是所有构造的起点。

2.  **复合结构 (Composite Structures):** 任何非原子的合式公式都代表一个复合结构。结构的构造方式由联结词 $≡$ 和 $\triangleright$ 定义。

3.  **结构展开 (Structural Expansion - $\triangleright$):**
    算子 $A \triangleright B$ 表示一种非对称的复合操作，其中结构 $A$ 作为**上下文 (Context)** 或**模板 (Template)**，而结构 $B$ 作为被置于该上下文中的**内容 (Content)**。$A$ 被看作是“展开”或“容纳”$B$ 的外部结构。

4.  **构造等价 (Constructional Equivalence - $\equiv$):**
    $A ≡ B$ 是一个关于**构造结果**的断言。它声明，尽管蓝图 $A$ 和 $B$ 的句法形式可能不同，但它们所描述的最终构造对象是**同构的 (isomorphic)** 或**无法区分的 (indistinguishable)**。
    
    至关重要的是，$≡$ 算子本身也可以是构造的一部分。例如，在 $(A ≡ B) \triangleright C$ 中，$A ≡ B$ 这个“等价断言”本身被视为一个结构块，并作为上下文来展开 $C$。这暗示 $≡$ 在系统中扮演双重角色：
    *   **元语言层面 (Meta-level):** 作为顶层联结词时（如一个定理 $A \equiv B$），它陈述了两个对象间的关系。
    *   **对象语言层面 (Object-level):** 当被嵌套在更复杂的公式中时，它本身也成为构造蓝图的一部分，代表一个封装了“等价关系”的子结构。

#### **6.2. 公理与规则的结构解释**

*   **A1-A3 (自反性与结合律):** 这些公理定义了构造操作的基本代数性质。
    *   $A1$: 任何结构都与其自身等价。
    *   $A2$: $\triangleright$ 展开操作是结合的。这意味着多层嵌套的上下文 $((A \triangleright B) \triangleright C)$ 可以被重新组合为 $(A \triangleright (B \triangleright C))$ 而不改变最终结构。
    *   $A3$: 混合结合律表明，$≡$ 和 $\triangleright$ 两种操作符可以一种高度规则化的方式交换顺序。这暗示了两种构造操作之间存在深刻的互换性 (interchangeability)，使得系统的代数结构类似于环或格。

*   **R1-R3 (等价关系与同余):** 这些规则确立了 $≡$ 是一个**同余关系 (congruence relation)**。
    *   $R1$ (对称律) 和 $R2$ (传递律) 确认 $≡$ 是一个等价关系。
    *   $R3$ (同余律) 是关键：如果两个子结构 $A$ 和 $B$ 是构造等价的，那么在任何更大的结构 $C ∘ ...$ 中用 $B$ 替换 $A$，不会影响最终的构造等价性。这保证了等价的子结构可以被自由替换。

#### **6.3. R4 的代数解释：受限的上下文无关替换**

推理规则 R4 是理解此系统最关键的部分。
$$
\frac
{ (A \triangleright B) \equiv C, \quad (D \triangleright B) \equiv E \quad \text{且} \quad var(A) = var(D), \quad var(A) \cap var(B) = \emptyset }
{ C \equiv E }
$$

我们可以将此规则解释为一种**上下文无关的抽象 (Context-Free Abstraction)** 或**通用模板替换 (Generic Template Substitution)**。

*   **前提 $(A \triangleright B) ≡ C$ 和 $(D \triangleright B) ≡ E$:**
    将同一内容 $B$ 分别置于两个不同的上下文 $A$ 和 $D$ 中，分别产生了构造结果 $C$ 和 $E$。

*   **条件 $var(A) \cap var(B) = \emptyset$:**
    这个“变量不交”的约束是核心。它在代数上意味着上下文 $A$（和 $D$）与内容 $B$ 是**结构独立的 (structurally independent)**。上下文 $A$ 的构造不依赖于 $B$ 中的任何原子结构，反之亦然。$A$ 对于 $B$ 而言是一个**通用模板 (generic template)**，它不与 $B$ 的内部成分发生任何特定的交互。

*   **条件 $var(A) = var(D)$:**
    此条件断言，尽管上下文 $A$ 和 $D$ 的句法形式（即它们的构造蓝图）可能不同，但它们是由**完全相同的原子结构集合**构成的。它们使用了相同的“原材料”。

*   **结论 $C ≡ E$:**
    该规则的意向是：当一个内容 $B$ 被一个与其结构独立的通用模板（如 $A$ 或 $D$）展开时，模板的具体句法形式无关紧要；唯一决定最终构造类别的是**模板所使用的原子结构集合**。
    
    换言之，对于一个“外来”的内容 $B$，所有由相同原子结构集构成的、且与 $B$ 结构独立的模板，在展开 $B$ 时都起着**相同的作用**。$A$ 和 $D$ 在此操作中是**等效的功能模板 (functionally equivalent templates)**，尽管它们本身可能并非构造等价的（即系统不一定能证明 $A \equiv D$）。

#### **6.4. 一致性的意向根源**

从该模型的角度来看，系统的一致性是其内在“物料守恒定律”的直接结果。
*   $var()$ 函数可以被看作是计算一个结构蓝图所需的**原子原材料清单**。
*   公理和 R1-R3 规则都显而易见地**保持**了这个清单的平衡：等价结构的两边必须拥有完全相同的原材料清单。
*   R4 虽然形式复杂，但其设计同样严格地维持了这种平衡：$var(C) = var(A \triangleright B) = var(A) \cup var(B)$，同时 $var(E) = var(D \triangleright B) = var(D) \cup var(B)$。由于 $var(A)=var(D)$，因此 $var(C)=var(E)$ 必然成立。
*   公式 $p \equiv q$ (对于不同的原子 $p$, $q$) 意图声明一个仅由 ${p}$ 构成的结构与一个仅由 ${q}$ 构成的结构是等价的。这从根本上违反了系统的“物料守恒”原则，因此它永远不可能通过遵守这些原则的规则被构造出来。


### 7. 非退化性
为了证明 $(A\equiv B)\equiv(A\triangleright B)$ 是不可证的，我们将采用**模型论（语义）方法**。

#### **7.1. 模型的构造**

定义一个映射（赋值函数） $v: \mathbf{WFF} \to \mathbb{Z}$，将每一个合式公式映射到整数集 $\mathbb{Z}$。

**1.1. 命题变量的赋值**
对于任意命题变量 $p \in \mathcal{P}$，定义其估值为常数 2：
$$v(p) = 2$$

**1.2. 联结词的赋值**
对于任意合式公式 $\phi, \psi$，定义联结词的运算如下：
*   **等价 ($\equiv$)** 被解释为整数的**乘法**：
    $$v(\phi \equiv \psi) = v(\phi) \times v(\psi)$$
*   **展开 ($\triangleright$)** 被解释为常数 **0**（零函数）：
    $$v(\phi \triangleright \psi) = 0$$

#### **7.2. 模型的可靠性证明**

我们需要验证该形式系统的所有公理和推理规则在这个模型下都是“有效”的。在这里，“有效”意味着对于任何定理 $X \equiv Y$，都有 $v(X) = v(Y)$。

**2.1. 验证公理模式**

*   **A1: $A \equiv A$**
	* 在此公理中，LHS (左手边) 是 $A$，RHS (右手边) 也是 $A$。
	* 我们需要验证 $v(\text{LHS}) = v(\text{RHS})$，即 $v(A) = v(A)$。
	* 此等式因等式的自反性而永真。**故 A1 在模型中有效。**

*   **A2: $((A \triangleright B) \triangleright C) \equiv (A \triangleright (B \triangleright C))$**
    *   左边估值：$v((A \triangleright B) \triangleright C) = 0$ （因为外层是 $\triangleright$）。
    *   右边估值：$v(A \triangleright (B \triangleright C)) = 0$ （因为外层是 $\triangleright$）。
    *   $0 = 0$，**A2 成立。**

*   **A3.1: $((A \equiv B) \triangleright C) \equiv (A \equiv (B \triangleright C))$**
    *   左边估值：$v((A \equiv B) \triangleright C) = 0$。
    *   右边估值：$v(A \equiv (B \triangleright C)) = v(A) \times v(B \triangleright C) = v(A) \times 0 = 0$。
    *   $0 = 0$，**A3.1 成立。**

*   **A3.2: $(A \triangleright (B \equiv C)) \equiv ((A \triangleright B) \equiv C)$**
    *   左边估值：$v(A \triangleright (B \equiv C)) = 0$。
    *   右边估值：$v((A \triangleright B) \equiv C) = v(A \triangleright B) \times v(C) = 0 \times v(C) = 0$。
    *   $0 = 0$，**A3.2 成立。**

**2.2. 验证推理规则**

假设前提中的公式在模型中估值相等，我们需要证明结论中的公式估值也相等。

*   **R1 (对称律) & R2 (传递律):**
    由于整数相等关系具有对称性和传递性，这两条规则显然成立。

*   **R3 (同余律):**
    假设 $v(A) = v(B)$。
    *   对于 $\equiv$: $v(A \equiv C) = v(A)v(C)$，而 $v(B \equiv C) = v(B)v(C)$。由于 $v(A)=v(B)$，则两者相等。
    *   对于 $\triangleright$: $v(A \triangleright C) = 0$，且 $v(B \triangleright C) = 0$。两者相等。
    **R3 成立。**

*   **R4 (变量不交替换规则):**
    前提：$v(A \triangleright B) = v(C)$ 且 $v(D \triangleright B) = v(E)$。
    根据我们的定义，$v(A \triangleright B) = 0$ 且 $v(D \triangleright B) = 0$。
    因此，前提实际上意味着 $0 = v(C)$ 且 $0 = v(E)$。
    结论要求：$C \equiv E$ 即 $v(C) = v(E)$。
    由于 $v(C)=0$ 且 $v(E)=0$，所以 $v(C) = v(E)$ 显然成立。
    （注：此规则成立甚至不需要考虑变量集条件 $var(A)=var(D)$，因为在这个特定模型中 $\triangleright$ 的值恒为 0）。
    **R4 成立。**

#### **7.3. 证明目标公式不可证**

我们已经证明：如果 $X \equiv Y$ 是该形式系统的定理，那么在我们的模型中必然有 $v(X) = v(Y)$。

现在考察命题 $(A \equiv B) \equiv (A \triangleright B)$。
假设这是一个定理，那么必须满足：
$$v(A \equiv B) = v(A \triangleright B)$$

计算两边的估值（取 $A, B$ 为具体的命题变量 $p, q$）：
1.  **左边 (LHS):**
    $$v(p \equiv q) = v(p) \times v(q) = 2 \times 2 = 4$$
2.  **右边 (RHS):**
    $$v(p \triangleright q) = 0$$

显然，**$4 \neq 0$**。

#### **7.4. 结论**

由于存在一个模型使得该系统的所有公理和推理规则均有效，但公式 $(A \equiv B) \equiv (A \triangleright B)$ 在该模型中不成立（即左右两边估值不相等），根据数理逻辑的可靠性定理（Soundness Theorem）：

**结论：公式 $(A \equiv B) \equiv (A \triangleright B)$ 在该形式系统中是不可证的，所以，两个算子不退化为一个算子。**

**证毕。**


### **8. 元定理：上下文功能等价性与替换元定理**

本节旨在证明一个强大的元定理，该定理将推理规则 R4 的内在逻辑提升为一个在任意公式结构中均可应用的普适性替换原理。

---

**定义 8.1 (公式框架与替换)**

1.  **公式框架 (Formula Frame):** 公式框架 $Φ(•)$ 是一个带有一个占位符 $•$ 的表达式，其定义如下：
    *   **基础:** $•$ 本身是一个公式框架。
    *   **递归:** 如果 $Ψ(•)$ 是一个公式框架，$H$ 是一个合式公式 (WFF)，且 $∘ ∈ {≡, \triangleright}$，那么 $(Ψ(•) ∘ H)$ 和 $(H ∘ Ψ(•))$ 都是公式框架。

2.  **替换 (Substitution):** 记号 $Φ(A)$ 表示将公式框架 $Φ(•)$ 中的占位符 $•$ 替换为合式公式 $A$ 后所得到的合式公式。

---

在证明主定理之前，我们首先证明一个关键的引理，它确立了在特定条件下两个复合结构的等价性。

**引理 8.3 (核心替换引理)**

设 $A, B, D$ 为任意合式公式，且满足以下句法条件：
1.  $var(A) = var(D)$
2.  $var(A) ∩ var(B) = ∅$

则对于任意公式框架 $Φ(•)$，以下命题于本形式系统中可证：
$$
\vdash \Phi(A \triangleright B) \equiv \Phi(D \triangleright B)
$$

**证明:**
我们通过对公式框架 $Φ(•)$ 的结构进行数学归纳来证明此引理。

**1. 基础情形:**
当 $Φ(•) = •$ 时，我们需要证明 $⊢ (A \triangleright B) \equiv (D \triangleright B)$。
1.  $⊢ (A \triangleright B) ≡ (A \triangleright B)$
    *   依据: **A1 (等价的自反律)**
2.  $⊢ (D \triangleright B) ≡ (D \triangleright B)$
    *   依据: **A1 (等价的自反律)**
3.  我们拥有以下前提，准备应用 R4：
    *   前提 1: $(A \triangleright B) ≡ (A \triangleright B)$
    *   前提 2: $(D \triangleright B) ≡ (D \triangleright B)$
    *   句法条件: $var(A) = var(D)$ 且 $var(A) ∩ var(B) = ∅$ (由引理假设给出)
4.  应用 **R4 (变量不交替换规则)**，令 $C$ 为 $(A \triangleright B)$，$E$ 为 $(D \triangleright B)$，可得：
    $⊢ (A \triangleright B) equiv (D \triangleright B)$
基础情形得证。

**2. 归纳步骤:**
**归纳假设:** 对于任意结构比 $Φ(•)$ 简单的框架 $Ψ(•)$，引理成立。即 $⊢ Ψ(A \triangleright B) ≡ Ψ(D \triangleright B)$。

现在，我们证明对于 $Φ(•)$，引理也成立。$Φ(•)$ 必为以下两种形式之一（对于任意 $H ∈ WFF$ 和 $∘ ∈ {≡, \triangleright}$）：
   (i) $Φ(•) = (Ψ(•) ∘ H)$
   (ii) $Φ(•) = (H ∘ Ψ(•))$

我们仅证明情形 (i)，情形 (ii) 的证明是完全对称的。
1.  根据归纳假设，我们有：
    $⊢ Ψ(A \triangleright B) ≡ Ψ(D \triangleright B)$
2.  应用 **R3 (同余律)** 的第一种形式于上述已证定理，可得：
    $⊢ (Ψ(A \triangleright B) ∘ H) ≡ (Ψ(D \triangleright B) ∘ H)$
3.  根据替换的定义，此即为：
    $⊢ Φ(A \triangleright B) ≡ Φ(D \triangleright B)$
归纳步骤得证。

综上所述，通过数学归纳法，引理 8.3 成立。
**Q.E.D.**

---

**元定理 8.4 (上下文功能等价性与替换元定理)**

设 $A, B, D, G$ 为任意合式公式，且 $A, B, D$ 满足以下句法条件：
1.  $var(A) = var(D)$
2.  $var(A) ∩ var(B) = ∅$

设 $Φ(•)$ 为任意公式框架。则：
$$
\vdash \Phi(A \triangleright B) \equiv G \quad \text{当且仅当} \quad \vdash \Phi(D \triangleright B) \equiv G
$$

**证明:**
该定理是一个双向蕴含命题。

**第一部分 (⇒):**
**假设:** $⊢ Φ(A \triangleright B) ≡ G$。
**目标:** 证明 $⊢ Φ(D \triangleright B) ≡ G$。

1.  $⊢ \Phi(A \triangleright B) \equiv G$
    *   依据: **假设**
2.  $⊢ G \equiv \Phi(A \triangleright B)$
    *   依据: 对 (1) 应用 **R1 (对称律)**
3.  $⊢ \Phi(A \triangleright B) \equiv \Phi(D \triangleright B)$
    *   依据: **引理 8.3**
4.  $⊢ G \equiv \Phi(D \triangleright B)$
    *   依据: 对 (2) 和 (3) 应用 **R2 (传递律)**
5.  $⊢ \Phi(D \triangleright B) \equiv G$
    *   依据: 对 (4) 应用 **R1 (对称律)**

**第二部分 (⇐):**
**假设:** $⊢ Φ(D \triangleright B) ≡ G$。
**目标:** 证明 $⊢ Φ(A \triangleright B) ≡ G$。

该部分的证明与第一部分完全对称。因为句法条件 $var(A) = var(D)$ 是对称的，引理 8.3 的结论 $⊢ Φ(A \triangleright B) ≡ Φ(D \triangleright B)$ 也是对称的（可通过 R1 得到 $⊢ Φ(D \triangleright B) ≡ Φ(A \triangleright B)$）。因此，只需在上述证明过程中交换 $A$ 和 $D$ 的角色即可。

由于双向蕴含均已证明，元定理 8.4 成立。
**Q.E.D.**

---

### **9. 形式语义学 (Formal Semantics)**

我们将定义一类代数结构，作为该形式语言的模型。一个公式 $A ≡ B$ 在语义上有效，意味着在所有这类代数结构中，$A$ 和 $B$ 被解释为相同的对象。

**定义 9.1 (上下文功能代数 - Contextual Functionality Algebra)**

一个**上下文功能代数** (CFA) 是一个多元组 $\mathcal{A} = (\mathcal{U}, \{\mathcal{U}_S\}_{S \subseteq_{fin} \mathcal{P}}, \otimes_\equiv, \otimes_\triangleright)$，其中：

1.  $\mathcal{P}$ 是命题变量集。
2.  $\mathcal{U}$ 是代数的**全域 (Universe)**。
3.  $\{\mathcal{U}_S\}_{S \subseteq_{fin} \mathcal{P}}$ 是对全域 $\mathcal{U}$ 的一个**分层 (Stratification)**。其中 $S$ 是 $\mathcal{P}$ 的任意有限子集，$\mathcal{U}_S \subseteq \mathcal{U}$，且满足：
    *   如果 $S \neq T$，则 $\mathcal{U}_S \cap \mathcal{U}_T = \emptyset$。（不同变量集的元素属于不同层次）
    *   $\mathcal{U} = \bigcup_{S \subseteq_{fin} \mathcal{P}} \mathcal{U}_S$。（全域由所有层次构成）
4.  $\otimes_\equiv: \mathcal{U} \times \mathcal{U} \to \mathcal{U}$ 和 $\otimes_\triangleright: \mathcal{U} \times \mathcal{U} \to \mathcal{U}$ 是两个二元运算，满足以下公理：
    *   **分层兼容性 (Stratification Compatibility):** 对于任意 $a \in \mathcal{U}_S$ 和 $b \in \mathcal{U}_T$，以及任意算子 $\circ \in \{\equiv, \triangleright\}$，必有 $a \otimes_\circ b \in \mathcal{U}_{S \cup T}$。
    *   **结合律公理 (Associativity Axioms):**
        *   A2': 对于任意 $a, b, c \in \mathcal{U}$，$(a \otimes_\triangleright b) \otimes_\triangleright c = a \otimes_\triangleright (b \otimes_\triangleright c)$。。
	    *   A3': 对于任意 $a, b, c \in \mathcal{U}$，
		    * $(a \otimes_\equiv b) \otimes_\triangleright c = a \otimes_\equiv (b \otimes_\triangleright c)$。 
		    *  $a \otimes_\triangleright (b \otimes_\equiv c) = (a \otimes_\triangleright b) \otimes_\equiv c$。 

    *   **上下文功能等价公理 (Contextual Functional Equivalence Axiom):** 这是对应于 R4 和元定理 8.4 的核心语义公理。
        对于任意不相交的有限变量集 $S, T \subseteq_{fin} \mathcal{P}$ (即 $S \cap T = \emptyset$)，任意两个元素 $a, d \in \mathcal{U}_S$ 和任意元素 $b \in \mathcal{U}_T$，在代数中以下等式必须成立：
        $$
        a \otimes_\triangleright b = d \otimes_\triangleright b
        $$

**定义 9.2 (解释与有效性)**

1.  **解释 (Interpretation):** 一个在代数 $\mathcal{A}$ 中的解释 $I$ 是一个映射 $I: \mathbf{WFF} \to \mathcal{U}$，它满足：
    *   **基础:** 对于任意命题变量 $p \in \mathcal{P}$，$I(p) \in \mathcal{U}_{\{p\}}$。
    *   **递归:** 对于任意合式公式 $\phi, \psi$ 和算子 $\circ \in \{\equiv, \triangleright\}$，
        $I(\phi \circ \psi) = I(\phi) \otimes_\circ I(\psi)$。
    *   一个自然的推论是：对于任意公式 $\phi$，必有 $I(\phi) \in \mathcal{U}_{var(\phi)}$。

2.  **语义有效性 (Semantic Validity):** 一个公式 $A \equiv B$ 被称为**语义有效的 (semantically valid)**，记为 $\models A \equiv B$，当且仅当对于**每一个**上下文功能代数 $\mathcal{A}$ 和**每一个**可能的解释 $I$，都有 $I(A) = I(B)$。

---

### **10. 完备性定理 (The Completeness Theorem)**

现在，我们可以正式陈述该系统的完备性定理。

**定理 10.1 (可靠性与完备性)**

设 $A$ 和 $B$ 为任意两个合式公式。则：
$$
\vdash A \equiv B \quad \Longleftrightarrow \quad \models A \equiv B
$$
换言之，一个公式是可证的，当且仅当它是语义有效的。

**证明思路:**

**第一部分：可靠性 (Soundness, $\Rightarrow$)**

可靠性证明相对直接。我们需要证明，如果 $\vdash A \equiv B$，那么 $\models A \equiv B$。这等价于证明所有公理在任何CFA中都解释为等式，并且所有推理规则都保持等式成立。

*   **公理:**
    *   **A1 ($A \equiv A$):** 语义上对应 $I(A) = I(A)$，此为自反性，永真。
    *   **A2, A3:** 所有这些公理都在任何CFA中解释为真等式。
    *   **对于 A2 $((A \triangleright B) \triangleright C) ≡ (A \triangleright (B \triangleright C))$：**
         我们需要验证 $I(((A \triangleright B) \triangleright C)) = I((A \triangleright (B \triangleright C)))$。
         这等价于 $(I(A) \otimes_\triangleright I(B)) \otimes_\triangleright I(C) = I(A) \otimes_\triangleright (I(B) \otimes_\triangleright I(C))$。
         这正是代数公理 **A2'** 的内容。
    *   **对于 A3.1 $((A ≡ B) \triangleright C) ≡ (A ≡ (B \triangleright C))$：**
         我们需要验证 $I(((A \equiv B) \triangleright C)) = I((A \equiv (B \triangleright C)))$。
         这等价于 $(I(A) \otimes_\equiv I(B)) \otimes_\triangleright I(C) = I(A) \otimes_\equiv (I(B) \otimes_\triangleright I(C))$。
         这正是代数公理 **A3'** 的第一部分。
    *   **对于 A3.2 $(A \triangleright (B ≡ C)) ≡ ((A \triangleright B) ≡ C)$：**
         我们需要验证 $I((A \triangleright (B \equiv C))) = I(((A \triangleright B) \equiv C))$。
         这等价于 $I(A) \otimes_\triangleright (I(B) \otimes_\equiv I(C)) = (I(A) \otimes_\triangleright I(B)) \otimes_\equiv I(C)$。
         这正是代数公理 **A3'** 的第二部分。
     因此，所有公理模式在语义上均有效。
*   **推理规则:** 假设前提在任意CFA中都成立（即解释为等式），需证明结论也成立。
    *   **R1, R2, R3:** 整数的等价关系天然满足对称性、传递性和同余性，因此这些规则显然保持等式。
    *   **R4:** 假设 $\models (A \triangleright B) \equiv C$ 和 $\models (D \triangleright B) \equiv E$，且 $var(A)=var(D)=S$, $var(A) \cap var(B)=\emptyset$。
        *   这意味着在任意CFA $\mathcal{A}$ 和解释 $I$ 中，$I(A \triangleright B) = I(C)$ 且 $I(D \triangleright B) = I(E)$。
        *   即 $I(A) \otimes_\triangleright I(B) = I(C)$ 且 $I(D) \otimes_\triangleright I(B) = I(E)$。
        *   根据CFA的定义， $I(A) \in \mathcal{U}_S$, $I(D) \in \mathcal{U}_S$, $I(B) \in \mathcal{U}_{var(B)}$，且 $S \cap var(B) = \emptyset$。
        *   应用**上下文功能等价公理**，我们得到 $I(A) \otimes_\triangleright I(B) = I(D) \otimes_\triangleright I(B)$。
        *   因此，$I(C) = I(E)$。
        *   这意味着 $\models C \equiv E$。
    
可靠性得证。

**第二部分：完备性 (Completeness, $\Leftarrow$)**

完备性证明中，我们将使用标准的**林登鲍姆-塔斯基代数 (Lindenbaum-Tarski Algebra)** 方法来构造一个**典范模型 (Canonical Model)**。

1.  **定义句法等价关系:** 在合式公式集 **WFF** 上定义一个关系 $\sim$：
    $$
    A \sim B \quad \text{当且仅当} \quad \vdash A \equiv B
    $$
    根据公理 A1 和规则 R1, R2，$\sim$ 是一个等价关系。根据规则 R3，$\sim$ 是一个同余关系。

2.  **构造林登鲍姆-塔斯基代数 $\mathcal{A}_{LT}$:**
    *   令 $[A]$ 表示公式 $A$ 所在的等价类。
    *   **全域:** $\mathcal{U}_{LT} = \{[A] \mid A \in \mathbf{WFF}\}$。
    *   **分层:** 对于每个有限变量集 $S \subset \mathcal{P}$，定义层次 $\mathcal{U}_S = \{[A] \mid var(A)=S\}$。根据您的一致性证明（引理 5.2），如果 $[A]=[B]$ (即 $\vdash A \equiv B$)，则 $var(A)=var(B)$。这保证了分层是良定义的。
    *   **运算:** 定义运算如下：
        *   $[A] \otimes_\equiv [B] = [A \equiv B]$
        *   $[A] \otimes_\triangleright [B] = [A \triangleright B]$
        因为 $\sim$ 是同余关系，这些运算是良定义的。

3.  **证明 $\mathcal{A}_{LT}$ 是一个CFA:**
    *   **分层兼容性:** $var(A \circ B) = var(A) \cup var(B)$，所以 $[A] \in \mathcal{U}_{var(A)}, [B] \in \mathcal{U}_{var(B)}$ 蕴含 $[A \circ B] \in \mathcal{U}_{var(A) \cup var(B)}$。得证。
	 *   **结合律公理:** 我们需要验证 $\mathcal{A}_{LT}$ 满足代数公理 A2' 和 A3'。
	     *   **验证 A2':** 我们需要证明 $([A] \otimes_\triangleright [B]) \otimes_\triangleright [C] = [A] \otimes_\triangleright ([B] \otimes_\triangleright [C])$。
	         这等价于证明 $[(A \triangleright B) \triangleright C] = [A \triangleright (B \triangleright C)]$，
	         根据 $~$ 的定义，这等价于 $\vdash ((A \triangleright B) \triangleright C) \equiv (A \triangleright (B \triangleright C))$。
	         这正是句法公理 **A2**。
	     *   **验证 A3' (第一部分):** 我们需要证明 $([A] \otimes_\equiv [B]) \otimes_\triangleright [C] = [A] \otimes_\equiv ([B] \otimes_\triangleright [C])$。
	         这等价于证明 $[(A \equiv B) \triangleright C] = [A \equiv (B \triangleright C)]$，
	         即 $\vdash ((A \equiv B) \triangleright C) \equiv (A \equiv (B \triangleright C))$。
	         这正是句法公理 **A3.1**。
	     *   **验证 A3' (第二部分):** 我们需要证明 $[A] \otimes_\triangleright ([B] \otimes_\equiv [C]) = ([A] \otimes_\triangleright [B]) \otimes_\equiv [C]$。
	         这等价于证明 $[A \triangleright (B \equiv C)] = [(A \triangleright B) \equiv C]$，
	         即 $\vdash (A \triangleright (B \equiv C)) \equiv ((A \triangleright B) \equiv C)$。
	         这正是句法公理 **A3.2**。
	     因此，$\mathcal{A}_{LT}$ 满足所有结合律公理。
    *   **上下文功能等价公理:** 我们需要证明，如果 $S \cap T = \emptyset$，且 $[A], [D] \in \mathcal{U}_S$, $[B] \in \mathcal{U}_T$，则 $[A] \otimes_\triangleright [B] = [D] \otimes_\triangleright [B]$。
        *   这等价于证明，如果 $var(A)=var(D)=S$ 且 $var(B)=T$ 且 $S \cap T = \emptyset$，则 $\vdash (A \triangleright B) \equiv (D \triangleright B)$。
        *   这正是**引理 8.3** 的基础情形（当框架 $\Phi(\cdot) = \cdot$ 时）所证明的结论。因此，该公理在 $\mathcal{A}_{LT}$ 中成立。

4.  **完成证明:**
    *   我们已经构造了一个典范模型 $\mathcal{A}_{LT}$，它本身就是一个CFA。
    *   现在，假设 $\models A \equiv B$。这意味着在**所有**CFA中，$A$ 和 $B$ 的解释都相等。
    *   由于 $\mathcal{A}_{LT}$ 是一个CFA，所以等式在 $\mathcal{A}_{LT}$ 中也必须成立。
    *   在 $\mathcal{A}_{LT}$ 中定义一个**典范解释** $I_{LT}$，使得 $I_{LT}(\phi) = [\phi]$。
    *   那么 $I_{LT}(A) = [A]$ 并且 $I_{LT}(B) = [B]$。
    *   因为 $\models A \equiv B$，所以在 $\mathcal{A}_{LT}$ 中有 $I_{LT}(A) = I_{LT}(B)$，即 $[A] = [B]$。
    *   根据等价类 $~$ 的定义，$[A] = [B]$ 意味着 $\vdash A \equiv B$。

完备性得证。 **Q.E.D.**


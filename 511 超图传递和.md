# 形式系统 $\mathcal{S}$ 

## 1. 语形论 (Syntax)

### 1.1 字母表 (Alphabet)
形式系统 $\mathcal{S}$ 的符号集合 $\Sigma$ 由以下部分组成：
1.  **变量集**: $V = \{a, b, c, \dots, x, y, z, \dots\}$，包含可数无穷多个个体变量。
2.  **算子集**:
    *   一元算子: $\mathbf{0}$
    *   二元算子: $\mathbf{1}, \mathbf{2}$
3.  **辅助符号**: $(, )$

### 1.2 合式公式 (Well-Formed Formulas, WFF)
公式集合 $\mathcal{F}$ 归纳定义如下：
1.  若 $v \in V$，则 $v \in \mathcal{F}$。
2.  若 $\phi \in \mathcal{F}$，则 $\mathbf{0}(\phi) \in \mathcal{F}$。
3.  若 $\phi, \psi \in \mathcal{F}$，则 $(\phi \mathbf{1} \psi) \in \mathcal{F}$ 且 $(\phi \mathbf{2} \psi) \in \mathcal{F}$。
4.  $\mathcal{F}$ 是满足上述条件的最小集合。

为简便起见，在不引起歧义的情况下可省略外部括号。

---

## 2. 证明论 (Proof Theory)

### 2.1 公理模式 (Axiom Schemata)
对于任意 $\phi \in \mathcal{F}$，以下公式为公理：

*   **(A1)** $(\phi \mathbf{2} \phi)$
*   **(A2)** $\mathbf{0}(\mathbf{0}(\phi)) \mathbf{2} \phi$

### 2.2 推理规则 (Inference Rules)
对于任意 $\phi, \psi, \chi \in \mathcal{F}$，定义以下推理规则：

*   **(R1)** $\dfrac{\phi \mathbf{1} \psi, \quad \phi \mathbf{2} \chi}{(\phi \mathbf{2} \chi) \mathbf{1} \psi}$
*   **(R2)** $\dfrac{\phi \mathbf{1} \psi, \quad \phi \mathbf{1} \chi}{\psi \mathbf{2} \chi}$
*   **(R3)** $\dfrac{\phi \mathbf{1} (\psi \mathbf{2} \chi) , \quad \chi \mathbf{2} \omega }{\phi \mathbf{1} (\chi \mathbf{2} \omega)}$
*   **(R4)** $\dfrac{\phi \mathbf{2} \psi, \quad \psi \mathbf{2} \chi}{\phi \mathbf{2} \chi}$ 
*   **(R5)** $\dfrac{\phi \mathbf{1} \psi}{\mathbf{0}(\psi)\mathbf{1}\mathbf{0}(\phi)}$ 

### 2.3 推演 (Derivation)
如果存在一个有限的公式序列 $\alpha_1, \dots, \alpha_n$，使得每一个 $\alpha_i$ 要么是公理，要么是由序列中先前的公式通过推理规则得到，则称 $\alpha_n$ 是系统 $\mathcal{S}$ 的定理，记作 $\vdash_\mathcal{S} \alpha_n$。

---

## 3. 模型论语义 (Model Theoretic Semantics)

本节采用 **投影-类流模型 (Projective Class-Flow Model)** 为系统 $\mathcal{S}$ 提供语义。

### 3.1 模型结构 (Model Structure)

定义 $\mathcal{S}$ 的一个模型为四元组 $\mathfrak{M} = \langle \mathbb{D}, (\cdot)^*, \sim, f \rangle$，其中：

1.  **论域 (Domain) $\mathbb{D}$**: 一个非空集合。
2.  **对偶算子 $(\cdot)^*: \mathbb{D} \to \mathbb{D}$**:
    *   $\mathbb{D}$ 上的对合双射：$\forall x, (x^*)^* = x$。
3.  **等价关系 $\sim \subseteq \mathbb{D} \times \mathbb{D}$**:
    *   $\mathbb{D}$ 上的等价关系。
    *   记 $[x]_\sim$ 为包含 $x$ 的等价类。商集记为 $\mathcal{K} = \mathbb{D}/\sim$。
    *   **相容性**: $x \sim y \iff x^* \sim y^*$。由此诱导出商集上的对偶 $K^* = \{x^* \mid x \in K\}$。
4.  **确定性流函数 (Deterministic Flow Function) $f: \mathcal{K} \to \mathcal{K}$**:
    *   $f$ 是定义在等价类上的函数，表示流的唯一确定去向。
    *   **规则 R5 约束**: $\forall K \in \mathcal{K}, f(f(K)^*) = K^*$。

---

### 3.2 解释与真值定义 (Interpretation and Truth)

我们首先定义**支撑集 (Support)** 的概念。对于任意子集 $S \subseteq \mathbb{D}$，其支撑集定义为它所涉及的所有等价类的集合：
$$ \text{supp}(S) = \{ [x]_\sim \mid x \in S \} \subseteq \mathcal{K} $$

还需定义支撑集上的流像：$f[\Sigma] = \{ f(K) \mid K \in \Sigma \}$。

**定义 3.2.1 (项的指称 - 投影语义):**
定义指称函数 $⟦ \cdot ⟧_\mathfrak{M}: \mathcal{F} \to \mathcal{P}(\mathbb{D}) \setminus \{\emptyset\}$：
1.  **变量**: $⟦ v ⟧_\mathfrak{M} = \{d_v\}$，其中 $d_v \in \mathbb{D}$。
2.  **一元算子**: $⟦ \mathbf{0}(\phi) ⟧_\mathfrak{M} = \{ x^* \mid x \in ⟦ \phi ⟧_\mathfrak{M} \} = (⟦\phi⟧_\mathfrak{M})^*$。
3.  **二元算子 $\mathbf{2}$**: $⟦ \phi \mathbf{2} \psi ⟧_\mathfrak{M} = ⟦ \psi ⟧_\mathfrak{M}$。
4.  **二元算子 $\mathbf{1}$**: $⟦ \phi \mathbf{1} \psi ⟧_\mathfrak{M} = ⟦ \psi ⟧_\mathfrak{M}$ (保持右投影以维持封闭性)。

**定义 3.2.2 (完备真值条件):**
对于任意公式 $\Phi \in \mathcal{F}$，$\mathfrak{M} \vDash \Phi$ 当且仅当 $\Phi$ 的顶层结构满足下列条件之一：

1.  **等价结构**: 若 $\Phi$ 形如 $\phi \mathbf{2} \psi$，则：
    $$ \mathfrak{M} \vDash \phi \mathbf{2} \psi \iff \text{supp}(⟦ \phi ⟧_\mathfrak{M}) = \text{supp}(⟦ \psi ⟧_\mathfrak{M}) $$
2.  **流变结构**: 若 $\Phi$ 形如 $\phi \mathbf{1} \psi$，则：
    $$ \mathfrak{M} \vDash \phi \mathbf{1} \psi \iff f[\text{supp}(⟦ \phi ⟧_\mathfrak{M})] = \text{supp}(⟦ \psi ⟧_\mathfrak{M}) $$

对于不属于上述两种形式的公式（如变量 $v$ 或一元项 $\mathbf{0}(\phi)$），定义 $\mathfrak{M} \not\vDash \Phi$。

---

### 3.3 存在性证明 (Unchanged)

**定理 3.3**: 存在满足上述定义的模型。
**证明**: 仍采用 3.3 节中的 $\mathfrak{M}_{canonical}$（单类模型）。由于全域只有 1 个等价类 $U$，且 $f(U)=U$，显然满足 $f(U^*) = f(U) = U$ 等所有约束。

---

### 3.4 可靠性证明 (Proof of Soundness)

**定理 3.4**: 若 $\vdash_\mathcal{S} \Phi$，则对于任意模型 $\mathfrak{M}$，$\mathfrak{M} \vDash \Phi$。

**证明**:
对推演规则进行归纳分析。记 $S_\phi = \text{supp}(⟦\phi⟧_\mathfrak{M})$。

1.  **公理 (A1) $\phi \mathbf{2} \phi$**:
    *   真值条件要求 $S_\phi = S_\phi$。根据集合论等号自反性，恒成立。
    *   *修正效果*: 无论 $\phi$ 是否跨类，此式恒真。

2.  **公理 (A2) $\mathbf{0}(\mathbf{0}(\phi)) \mathbf{2} \phi$**:
    *   根据指称定义，LHS 的支撑集为 $S_{\mathbf{0}(\mathbf{0}(\phi))} = \{ (K^*)^* \mid K \in S_\phi \}$。
    *   根据模型结构定义 3.1.2，$(\cdot)^*$ 是对合双射，故 $(K^*)^* = K$。
    *   因此 $S_{\mathbf{0}(\mathbf{0}(\phi))} = S_\phi$。
    *   根据 $\mathbf{2}$ 的真值条件，公式要求 $S_{\mathbf{0}(\mathbf{0}(\phi))} = S_\phi$，即 $S_\phi = S_\phi$。
    *   此式恒成立。

3.  **规则 (R1) $\dfrac{\phi \mathbf{1} \psi, \quad \phi \mathbf{2} \chi}{(\phi \mathbf{2} \chi) \mathbf{1} \psi}$**:
    *   前提 1: $f[S_\phi] = S_\psi$。
    *   前提 2: $S_\phi = S_\chi$。
    *   结论要求: $f[S_{(\phi \mathbf{2} \chi)}] = S_\psi$。
    *   根据指称定义 3.2.1，项 $⟦\phi \mathbf{2} \chi⟧ = ⟦\chi⟧$。
    *   故结论等价于验证 $f[S_\chi] = S_\psi$。
    *   结合前提 1 和 2: $f[S_\chi] = f[S_\phi] = S_\psi$。成立。

4.  **规则 (R2) $\dfrac{\phi \mathbf{1} \psi, \quad \phi \mathbf{1} \chi}{\psi \mathbf{2} \chi}$**:
    *   前提: $f[S_\phi] = S_\psi$ 且 $f[S_\phi] = S_\chi$。
    *   由于函数 $f$ 是单值的（确定性），故 $S_\psi = S_\chi$。
    *   这正是 $\psi \mathbf{2} \chi$ 的真值条件。成立。

5.  **规则 (R3) $\dfrac{\phi \mathbf{1} (\psi \mathbf{2} \chi) , \quad \chi \mathbf{2} \omega }{\phi \mathbf{1} (\chi \mathbf{2} \omega)}$**:
    *   前提 1: $\mathfrak{M} \vDash \phi \mathbf{1} (\psi \mathbf{2} \chi)$。
        *   项 $⟦\psi \mathbf{2} \chi⟧ = ⟦\chi⟧$ (右投影)。
        *   故语义为: $f[S_\phi] = S_\chi$。
    *   前提 2: $S_\chi = S_\omega$。
    *   结论要求: $\mathfrak{M} \vDash \phi \mathbf{1} (\chi \mathbf{2} \omega)$。
        *   项 $⟦\chi \mathbf{2} \omega⟧ = ⟦\omega⟧$ (右投影)。
        *   故需验证: $f[S_\phi] = S_\omega$。
    *   由 $f[S_\phi] = S_\chi$ 且 $S_\chi = S_\omega$ 可直接推出 $f[S_\phi] = S_\omega$。成立。

6.  **规则 (R4) $\dfrac{\phi \mathbf{2} \psi, \quad \psi \mathbf{2} \chi}{\phi \mathbf{2} \chi}$**:
    *   即 $S_\phi = S_\psi$ 且 $S_\psi = S_\chi \implies S_\phi = S_\chi$。由集合相等传递性保证。成立。

7.  **规则 (R5) $\dfrac{\phi \mathbf{1} \psi}{\mathbf{0}(\psi)1\mathbf{0}(\phi)}$**:
    *   前提: $f[S_\phi] = S_\psi$。即 $\forall K \in S_\phi, f(K) \in S_\psi$ 且满射。
    *   结论要求: $f[S_{\mathbf{0}(\psi)}] = S_{\mathbf{0}(\phi)}$。
    *   LHS (左手边) $= f[\{L^* \mid L \in S_\psi\}]$。
    *   RHS (右手边) $= \{K^* \mid K \in S_\phi\}$。
    *   利用模型约束 $f(L^*) = K^*$ (这是 $f(K^*) = K$ 的等价逆否吗？不，我们需要 R5 专用约束)。
    *   检查模型定义中的 R5 约束: $f(f(K)^*) = K^*$。
    *   令 $L = f(K)$。则 LHS 中的元素为 $f(L^*) = f(f(K)^*) = K^*$。
    *   由于 $f$ 将 $S_\phi$ 映射为 $S_\psi$，则 $f$ 作用于 $S_\psi$ 的对偶集将精确还原回 $S_\phi$ 的对偶集。成立。

---

### 3.5 一致性证明 (Proof of Consistency)

**定理 3.5**: 系统 $\mathcal{S}$ 是一致的。

**证明**:
构造离散反例模型 $\mathfrak{M}_{disc}$：
1.  $\mathbb{D} = \{a, b\} \times \{+, -\}$。
2.  $\sim$ 为等同关系 ($x \sim y \iff x=y$)。每个原子自成一类。
3.  流函数 $f$: 定义 $f(\{x\}) = \{x^*\}$。满足 $f(\{x\}^*) = f(\{x^*\}) = \{x\}$ (A2) 和 $f(f(\{x\})*) = f(\{x^*\}^*) = f(\{x\}) = \{x^*\} = \{x\}^*$ (R5)。

考虑公式 $\Psi = a \mathbf{1} a$。
*   $S_a = \{\{(a, +)\}\}$。
*   $\mathfrak{M}_{disc} \vDash a \mathbf{1} a \iff f[S_a] = S_a$。
*   $f[S_a] = \{\{(a, -)\}\}$。
*   而 $S_a = \{\{(a, +)\}\}$。
*   $\{(a, -)\} \neq \{(a, +)\}$，故模型不满足该公式。
*   $\nvdash a \mathbf{1} a$。系统存在不可证公式，故一致。

### 变量探针演算
#### **1. 语言 (Language)**

该形式语言由其字母表和合式公式的构造规则定义。

**1.1. 字母表 (Alphabet)**

1.  **命题变量集 (Set of Propositional Variables):** 一个可数的集合 $\mathcal{P} = \{p, q, r, p_0, p_1, \dots\}$。
2.  **二元联结词 (Binary Connectives):**
    *   $\equiv$  (等价)
    *   $\triangleright$ (展开)
3.  **辅助符号 (Auxiliary Symbols):**  $($, $)$

**1.2. 合式公式 (Well-formed Formulas - WFFs)**

合式公式的集合（记为 **WFF**）被递归地定义如下：

1.  **基础:** 如果 $\phi \in \mathcal{P}$，则 $\phi$ 是一个合式公式。
2.  **递归:** 如果 $\phi$ 和 $\psi$ 是合式公式，则 $(\phi \equiv \psi)$ 和 $(\phi \triangleright \psi)$ 也是合式公式。
3.  **封闭:** 只有通过有限次应用以上规则生成的表达式才是合式公式。

*注：为清晰起见，我们将省略最外层的括号。*

#### **2. 辅助定义：变量集函数 (Auxiliary Definition: Variable Set Function)**

为了陈述特殊的推理规则，我们定义一个函数 $var: \mathbf{WFF} \to 2^\mathcal{P}$，它返回一个公式中出现的所有命题变量的集合。

1.  **基础:** 对于任意命题变量 $p \in \mathcal{P}$，
    $var(p) = \{p\}$
2.  **递归:** 对于任意合式公式 $\phi, \psi$ 和任意二元联结词 $\circ \in \{\equiv, \triangleright\}$，
    $var((\phi \circ \psi)) = var(\phi) \cup var(\psi)$

#### **3. 公理模式 (Axiom Schemata)**

对于 **WFF** 中的任意公式 $A, B, C$，以下均为公理。

*   **A1: 等价的自反律 (Reflexivity of Equivalence)**
    $$
    A \equiv A
    $$

*   **A2: 展开的结合律 (Associativity of Expansion)**
    $$
    ((A \triangleright B) \triangleright C) \equiv (A \triangleright (B \triangleright C))
    $$

*   **A3: 混合结合律 (Mixed Associativity)**
    此公理模式包含两种形式，确保 $\equiv$ 和 $\triangleright$ 之间的结合性。
    1.  $((A \equiv B) \triangleright C) \equiv (A \equiv (B \triangleright C))$
    2.  $(A \triangleright (B \equiv C) ) \equiv ( (A \triangleright B) \equiv C)$

#### **4. 推理规则 (Inference Rules)**

设 $A, B, C, D, E$ 为任意合式公式。

*   **R1: 对称律 (Symmetry)**
    $$
    \frac{A \equiv B}{B \equiv A}
    $$

*   **R2: 传递律 (Transitivity)**
    $$
    \frac{A \equiv B, \quad B \equiv C}{A \equiv C}
    $$

*   **R3: 同余律 (Congruence)**
    对于任意二元联结词 $\circ \in \{\equiv, \triangleright\}$，此规则均适用。
    $$
    \frac{A \equiv B}{(A \circ C) \equiv (B \circ C)} \qquad \frac{A \equiv B}{(C \circ A) \equiv (C \circ B)}
    $$

*   **R4: 变量不交替换规则 (Variable-Disjoint Substitution Rule)**
    此规则基于公式的变量集进行约束。
        $$
    \frac
    { (A \triangleright B) \equiv (C \triangleright D) \quad \text{且} \quad var(A) = var(C), \quad var(A) \cap var(B) = \emptyset,\quad var(A) \cap var(D) = \emptyset }
    { B \equiv D }
    $$


---

### **5. 语义模型 (Semantics)**

我们将“变量探针演算”解释为一个基于**非空字符串序列代数**的结构。

#### **5.1. 预备定义 (Preliminaries)**

令 $\Sigma = \mathcal{P}$ 为字母表，即命题变量集合。
1.  **字符串集 $S$**: 定义 $S = \Sigma^+$ 为 $\Sigma$ 上所有有限非空字符串的集合。
    *   对于 $u, v \in S$，记 $u \cdot v$ 为字符串连接。
    *   对于 $u \in S$，记 $char(u) \subseteq \Sigma$ 为字符串 $u$ 中出现的字符集合。

2.  **域 $\mathbb{D}$**: 定义 $\mathbb{D} = S^+$ 为 $S$ 上所有有限非空序列的集合。
    *   $\mathbb{D}$ 中的元素记为 $\mathbf{x} = \langle x_1, x_2, \dots, x_n \rangle$，其中 $n \ge 1$ 且 $\forall i, x_i \in S$。

#### **5.2. 代数结构 $\mathcal{A}$**

定义代数结构 $\mathcal{A} = \langle \mathbb{D}, \oplus, \otimes \rangle$，其中二元运算定义如下：

设 $\mathbf{u} = \langle u_1, \dots, u_n \rangle \in \mathbb{D}$ 且 $\mathbf{v} = \langle v_1, \dots, v_m \rangle \in \mathbb{D}$。

**定义 5.2.1 (序列连接 $\oplus$):**
$$ \mathbf{u} \oplus \mathbf{v} \stackrel{\text{def}}{=} \langle u_1, \dots, u_n, v_1, \dots, v_m \rangle $$
*性质：结果序列长度为 $n+m$。*

**定义 5.2.2 (序列融合 $\otimes$):**
$$ \mathbf{u} \otimes \mathbf{v} \stackrel{\text{def}}{=} \langle u_1, \dots, u_{n-1}, (u_n \cdot v_1), v_2, \dots, v_m \rangle $$
*性质：结果序列长度为 $n+m-1$。由于 $u_n, v_1 \in S$，故 $u_n \cdot v_1 \in S$，运算封闭。*

#### **5.3. 解释与模型 (Interpretation and Model)**

**定义 5.3.1 (解释函数 $I$):**
解释函数 $I: \mathbf{WFF} \to \mathbb{D}$ 递归定义如下：
1.  $\forall p \in \mathcal{P}: \quad I(p) = \langle p \rangle$
2.  $I(A \equiv B) = I(A) \oplus I(B)$
3.  $I(A \triangleright B) = I(A) \otimes I(B)$

**定义 5.3.2 (语义有效性 $\models$):**
对于模型 $\mathfrak{M} = \langle \mathbb{D}, I \rangle$，公式 $A \equiv B$ 在模型中有效（记为 $\mathfrak{M} \models A \equiv B$），当且仅当：
$$ I(A) = I(B) $$
即 $A$ 和 $B$ 在解释下对应 $\mathbb{D}$ 中完全相同的序列。

---

### **6. 元理论 (Meta-theory)**

#### **6.1. 可靠性 (Soundness)**

**定理 6.1:** 若 $\vdash A \equiv B$，则 $\mathfrak{M} \models A \equiv B$。

**证明：**
通过对公理和推理规则的逐一验证来证明。

**1. 公理验证:**

*   **A1 (自反律) $A \equiv A$:**
    显然 $I(A) = I(A)$，故成立。

*   **A2 (展开结合律):**
    需证: $(I(A) \otimes I(B)) \otimes I(C) = I(A) \otimes (I(B) \otimes I(C))$。
    设 $I(A)$ 尾元素为 $a_{end}$，$I(B)$ 首元素为 $b_{start}$、尾元素为 $b_{end}$，$I(C)$ 首元素为 $c_{start}$。
    *   **LHS**: 先计算 $A \otimes B$，融合点产生字符串 $a_{end} \cdot b_{start}$。该序列的尾元素即为 $I(B)$ 的尾元素 $b_{end}$。再与 $C$ 融合，产生字符串 $b_{end} \cdot c_{start}$。
    *   **RHS**: 先计算 $B \otimes C$，融合点产生 $b_{end} \cdot c_{start}$。该序列首元素仍为 $b_{start}$。再与 $A$ 融合，产生 $a_{end} \cdot b_{start}$。
    *   两侧序列除融合点外其余元素结构未变，且字符串连接 $\cdot$ 满足结合律，故等式成立。

*   **A3 (混合结合律) $((A \equiv B) \triangleright C) \equiv (A \equiv (B \triangleright C))$:**
    需证: $(I(A) \oplus I(B)) \otimes I(C) = I(A) \oplus (I(B) \otimes I(C))$。
    设 $I(A) = \mathbf{a}, I(B) = \mathbf{b}, I(C) = \mathbf{c}$。
    *   **LHS**: $(\mathbf{a} \oplus \mathbf{b})$ 的尾元素是 $\mathbf{b}$ 的尾元素 $b_m$。与 $\mathbf{c}$ 融合得到 $\langle \dots, a_n, \dots, b_{m-1}, (b_m \cdot c_1), c_2, \dots \rangle$。
    *   **RHS**: $(\mathbf{b} \otimes \mathbf{c})$ 已经形成了融合项 $(b_m \cdot c_1)$。$\mathbf{a}$ 通过 $\oplus$ 连接在最前方，结果序列同上。
    *   故成立。

**2. 推理规则验证:**

*   **R1-R3 (相等关系的基本性质):**
    由于 $\models$ 定义为集合元素的相等，自反性、传递性和同余性（代换性）自然成立。

*   **R4 (变量不交替换规则):**
    **前提:** $I(A \triangleright B) = I(C \triangleright D)$。
    **条件:** $var(A) = var(C)$，且 $var(A) \cap var(B) = \emptyset, var(A) \cap var(D) = \emptyset$。
    **目标:** 证明 $I(B) = I(D)$。

  1.  **定义特征谓词**:
      令 $V = var(A)$。定义字符串性质 $P_V(s)$ 为真当且仅当 $char(s) \subseteq V$。
      由于 $var(C) = V$，对于 $I(A)$ 和 $I(C)$ 中的任意字符串元素 $x$，均有 $P_V(x)$ 为真。
      由于 $var(A) \cap var(B) = \emptyset$ 且 $var(A) \cap var(D) = \emptyset$，对于 $I(B)$ 和 $I(D)$ 中的任意字符串元素 $y$，均有 $char(y) \cap V = \emptyset$，即 $P_V(y)$ 为假。
 
  2.  **融合点的唯一索引定位**:
      考察序列 $I(A \triangleright B) = \langle u_1, u_2, \dots, u_N \rangle$。
      根据 $\otimes$ 的定义，$I(A \triangleright B)$ 的构造是将 $I(A)$ 的末项 $a_n$ 与 $I(B)$ 的首项 $b_1$ 融合为 $a_n \cdot b_1$，其余项保持不变。
      *   对于 $1 \le i < n$，项 $u_i = a_i$，故 $P_V(u_i)$ 为真。
      *   对于 $i = n$，项 $u_n = a_n \cdot b_1$。因 $a_n \in V^+$ 且 $b_1 \in (\Sigma \setminus V)^+$，该字符串非空且包含非 $V$ 字符，故 $P_V(u_n)$ 为假（注：$P_V$ 要求全属 $V$）。更精确地，它是序列中**第一个**包含非 $V$ 字符的项。
      
      同理，对于 $I(C \triangleright D) = \langle v_1, v_2, \dots, v_M \rangle$，设 $I(C)$ 长度为 $k$。则 $v_k = c_k \cdot d_1$ 是该序列中第一个包含非 $V$ 字符的项。
 
      **关键推论**: 由于 $I(A \triangleright B) = I(C \triangleright D)$，两个序列完全相等，故它们“第一个包含非 $V$ 字符的项”的索引必须相同。
      $$ \therefore n = k $$
      且对应项相等：$u_n = v_k \implies a_n \cdot b_1 = c_k \cdot d_1$。
 
  3. 字符串分解的唯一性 (Uniqueness of String Decomposition):
	    考察等式 $a_n \cdot b_1 = c_k \cdot d_1$。
	    已知 $a_n, c_k \in V^+$ (仅包含 $V$ 中的字符) 且 $b_1, d_1 \in (\Sigma \setminus V)^+$ (仅包含非 $V$ 字符)。
	   	定义辅助函数 $\ell_V: S \to \mathbb{N}$，其中 $\ell_V(w)$ 表示字符串 $w$ 中**仅由 $V$ 中字符构成的最长前缀的长度**。
	 *   对于 $w_{left} = a_n \cdot b_1$，由于 $a_n$ 全由 $V$ 构成，而 $b_1$ 的首字符 $b_{1,1} \notin V$，故 $\ell_V(w_{left}) = |a_n|$。
	 *   对于 $w_{right} = c_k \cdot d_1$，同理可得 $\ell_V(w_{right}) = |c_k|$。
	 
	   由于 $w_{left} = w_{right}$，必须有 $\ell_V(w_{left}) = \ell_V(w_{right})$，即 $|a_n| = |c_k|$。
	   在自由幺半群中，两个相等的字符串若具有相等的长度，则它们必须是同一个字符串。又因为 $a_n$ 和 $c_k$ 均为该字符串的长度为 $|a_n|$ 的前缀，故：
	 $$ a_n = c_k $$
	   进而由消去律（cancellation law）可得 $b_1 = d_1$。

 
  4.  **序列重构**:
      由 $I(A \triangleright B) = I(C \triangleright D)$ 及 $n=k$，可得序列其余部分一一对应相等。
      特别是序列的后半部分（索引 $n+1$ 到 $N$）：
      $$ \langle b_2, \dots, b_m \rangle = \langle d_2, \dots, d_j \rangle $$
      结合已证的 $b_1 = d_1$，我们有：
      $$ \langle b_1, b_2, \dots, b_m \rangle = \langle d_1, d_2, \dots, d_j \rangle $$
      即 $I(B) = I(D)$。证毕。

#### **6.2. 一致性 (Consistency)**

**定理 6.2:** 该系统是一致的，即 $\exists A, B$ 使得 $\nvdash A \equiv B$，且 $\nvdash (p \equiv q) \equiv (p \triangleright q)$。

**证明：**
1.  **非平凡性**:
    取 $p \neq q$。
    $I(p) = \langle p \rangle$, $I(q) = \langle q \rangle$。
    在 $\mathbb{D}$ 中，$\langle p \rangle \neq \langle q \rangle$（字符串 "p" 不等于 "q"）。
    由可靠性定理，若 $I(p) \neq I(q)$，则 $\nvdash p \equiv q$。

2.  **算符区分**:
    考察 $L = (p \equiv q)$ 和 $R = (p \triangleright q)$。
    $$ I(L) = \langle p \rangle \oplus \langle q \rangle = \langle p, q \rangle \quad (\text{序列长度为2}) $$
    $$ I(R) = \langle p \rangle \otimes \langle q \rangle = \langle pq \rangle \quad (\text{序列长度为1，元素为字符串 "pq"}) $$
    显然 $\langle p, q \rangle \neq \langle pq \rangle$。
    故 $\mathfrak{M} \not\models L \equiv R$，从而 $\nvdash (p \equiv q) \equiv (p \triangleright q)$。


# 不受信任的部分
#### **6.3. 完备性 (Completeness)**


为了证明 $\mathfrak{M} \models A \equiv B \implies \vdash A \equiv B$，我们引入严格的规范形式，并证明任意公式均可归约为其语义对应的语法表示。
 
**定义 6.3.1 (规范形式 - Canonical Normal Form, CNF)**
  一个公式 $\Phi$ 处于规范形式，当且仅当它具有如下递归结构：
  1.  **基本项 (Basic Term):** 形如 $p_1 \triangleright (p_2 \triangleright (\dots \triangleright p_m)\dots)$ 的公式，其中括号完全右结合。每个基本项 $T$ 唯一对应一个字符串 $str(T) = p_1 p_2 \dots p_m \in S$。
  2.  **规范公式:** 形如 $T_1 \equiv (T_2 \equiv (\dots \equiv T_k)\dots)$ 的公式，其中每个 $T_i$ 为基本项，且 $\equiv$ 完全右结合。
 
**引理 6.3.2 (语法-语义逆映射):**
  对于任意序列 $\mathbf{x} = \langle x_1, \dots, x_n \rangle \in \mathbb{D}$，存在唯一的规范公式 $\mathcal{F}(\mathbf{x})$，使得 $I(\mathcal{F}(\mathbf{x})) = \mathbf{x}$。
  *构造法：* 对于每个字符串 $x_i = c_1 c_2 \dots c_m$，构造基本项 $term(x_i) = c_1 \triangleright (c_2 \triangleright \dots c_m)$。令 $\mathcal{F}(\mathbf{x}) = term(x_1) \equiv (term(x_2) \equiv \dots term(x_n))$。显然解释 $I$ 将右结合的 $\triangleright$ 映射为字符串连接，将 $\equiv$ 映射为序列连接，故 $I(\mathcal{F}(\mathbf{x})) = \mathbf{x}$。
 
**引理 6.3.3 (归约定理):**
对于任意公式 $A$，设其语义解释为 $\mathbf{a} = I(A)$，则 $\vdash A \equiv \mathcal{F}(\mathbf{a})$。

**证明：**
对公式 $A$ 的构造深度进行归纳证明。

1.  **基准情形:**
    若 $A = p$ (命题变量)，则 $I(A) = \langle p \rangle$，$\mathcal{F}(\langle p \rangle) = p$。由 A1 (自反律)，$\vdash p \equiv p$ 成立。

2.  **归纳步骤 ($\equiv$):**
    设 $A = B \equiv C$。
    由归纳假设，$\vdash B \equiv \mathcal{F}(I(B))$ 且 $\vdash C \equiv \mathcal{F}(I(C))$。
    令 $\mathbf{T} = \mathcal{F}(I(B))$，$\mathbf{U} = \mathcal{F}(I(C))$。
    由 R3 (同余律)，$\vdash A \equiv (\mathbf{T} \equiv \mathbf{U})$。
    注意到 $\mathbf{T}$ 和 $\mathbf{U}$ 均为右结合的 $\equiv$-链。语义上 $I(A) = I(B) \oplus I(C)$ 对应的规范形式 $\mathcal{F}(I(A))$ 是将这两个序列连接后的右结合形式。
    利用 $\equiv$ 的结合律（作为等价关系的传递性及同余律的推论，或视作元语言层面的标准性质），可以将 $(\mathbf{T} \equiv \mathbf{U})$ 重组为完全右结合的形式，即 $\vdash A \equiv \mathcal{F}(I(A))$。

3.  **归纳步骤 ($\triangleright$):**
    设 $A = B \triangleright C$。
    由归纳假设，$\vdash B \equiv \mathbf{T}$ 且 $\vdash C \equiv \mathbf{U}$，其中 $\mathbf{T}, \mathbf{U}$ 为规范形式。
    设 $\mathbf{T}$ 的结构为 $T_1 \equiv (T_2 \equiv \dots \equiv T_n)$ (若 $n=1$ 则 $\mathbf{T}=T_1$)，$\mathbf{U}$ 的结构为 $U_1 \equiv \mathbf{U}_{rest}$ (若 $I(C)$ 长度为1，则无 $\mathbf{U}_{rest}$ 部分)。
    由 R3，$\vdash A \equiv (\mathbf{T} \triangleright \mathbf{U})$。
    我们需要证明 $(\mathbf{T} \triangleright \mathbf{U})$ 可语法归约为 $\mathcal{F}(I(B) \otimes I(C))$。

    *   **阶段 1：算符右移 (应用 A3.1)**
        若 $n > 1$，反复应用公理 **A3.1** $((X \equiv Y) \triangleright Z) \equiv (X \equiv (Y \triangleright Z))$。
        将 $\triangleright \mathbf{U}$ 逐层推入 $\mathbf{T}$ 的结构内部：
        $$ \vdash (\mathbf{T} \triangleright \mathbf{U}) \equiv (T_1 \equiv (T_2 \equiv \dots \equiv (T_n \triangleright \mathbf{U})\dots)) $$
        此时，$\triangleright$ 已作用于 $B$ 的末项 $T_n$。

    *   **阶段 2：算符左吸 (应用 A3.2)**
        考察核心项 $T_n \triangleright \mathbf{U}$。若 $\mathbf{U}$ 长度大于 1，即 $\mathbf{U} = U_1 \equiv \mathbf{U}_{rest}$，应用公理 **A3.2** $(X \triangleright (Y \equiv Z)) \equiv ((X \triangleright Y) \equiv Z)$：
        $$ \vdash (T_n \triangleright (U_1 \equiv \mathbf{U}_{rest})) \equiv ((T_n \triangleright U_1) \equiv \mathbf{U}_{rest}) $$
        此时，$\triangleright$ 已精确作用于 $B$ 的末项 $T_n$ 和 $C$ 的首项 $U_1$ 之间。

     *  **阶段 3：基本项融合 (Syntactic Concatenation via Induction):**
		 我们需要证明项 $(T_n \triangleright U_1)$ 形式等价于对应字符串连接后的规范基本项，即证明 $\vdash (T_n \triangleright U_1) \equiv term(str(T_n) \cdot str(U_1))$。
		 对基本项 $T_n$ 的构造深度进行归纳证明：
		 1.  **基准情形:** 若 $T_n = p$ (单个变量)，则 $str(T_n) = p$。
		    根据基本项构造定义，$term(p \cdot str(U_1))$ 在语法上被定义为 $p \triangleright term(str(U_1))$。
		    注意到 $U_1$ 本身即为 $term(str(U_1))$，故目标公式两侧完全由句法恒等式 (Syntactic Identity) 成立，无需公理即可得证。
		 2.  **归纳步骤:** 若 $T_n$ 具有复合结构 $p \triangleright T'$，其中 $T'$ 也是基本项。
		     *   应用公理 **A2** (展开结合律):
		         $$ \vdash ((p \triangleright T') \triangleright U_1) \equiv (p \triangleright (T' \triangleright U_1)) $$
		     *   应用归纳假设 (对 $T'$):
		         $$ \vdash (T' \triangleright U_1) \equiv term(str(T') \cdot str(U_1)) $$
		     *   应用规则 **R3** (同余律)，将归纳结果代入 A2 的右侧：
		         $$ \vdash (T_n \triangleright U_1) \equiv (p \triangleright term(str(T') \cdot str(U_1))) $$
		     *   根据定义，右侧即为 $term(p \cdot str(T') \cdot str(U_1))$，也就是 $term(str(T_n) \cdot str(U_1))$。
		 
		 **结论:**
		 综合上述三个阶段，原公式 $A$ 已被证明在演绎系统内等价于：
		 $$ T_1 \equiv (T_2 \equiv \dots \equiv (term(str(T_n) \cdot str(U_1)) \equiv \mathbf{U}_{rest})\dots) $$
		 这正是序列融合运算 $\mathbf{a} \otimes \mathbf{b}$ 所对应的规范形式 $\mathcal{F}(I(A))$。
		 故 $\vdash A \equiv \mathcal{F}(I(A))$ 证毕。
 
**定理 6.3 (完备性):** 若 $\mathfrak{M} \models A \equiv B$，则 $\vdash A \equiv B$。
 
**证明：**
 4.  假设 $\mathfrak{M} \models A \equiv B$，即 $I(A) = I(B)$。
 5.  令该公共语义值为序列 $\mathbf{s} \in \mathbb{D}$。
 6.  根据引理 6.3.3，我们有形式推导：
     $$ \vdash A \equiv \mathcal{F}(\mathbf{s}) $$
     $$ \vdash B \equiv \mathcal{F}(\mathbf{s}) $$
 7.  利用 R1 (对称律)，由 $\vdash B \equiv \mathcal{F}(\mathbf{s})$ 得 $\vdash \mathcal{F}(\mathbf{s}) \equiv B$。
 8.  利用 R2 (传递律)，由 $\vdash A \equiv \mathcal{F}(\mathbf{s})$ 和 $\vdash \mathcal{F}(\mathbf{s}) \equiv B$ 得：
     $$ \vdash A \equiv B $$
证毕。


### 高阶互换形式系统 L_I

#### 1. 语法 (Syntax)

##### **1.1 字母表 (Alphabet)**

L_I 的字母表包含以下几类符号：

*   **个体变量 (Individual Variables):** 一个可数无穷集 $V_I = \{x, y, z, x_{1}, ...\}$。
*   **谓词变量 (Predicate Variables):** 对每一个元数 (arity) $n ≥ 1$，存在一个可数无穷集 $V_P^n = \{P^n, Q^n, R^n, ...\}$。上标 $n$ 表示其元数，通常可以省略。
*   **逻辑联结词 (Logical Connectives):** $¬$ (否定), $→$ (蕴含)。
*   **量词 (Quantifier):** $∀$ (全称量词)。
*   **辅助符号 (Auxiliary Symbols):** $($, $)$, $,$。

##### **1.2 形成规则 (Formation Rules)**

我们通过对自然数 $k \in \mathbb{N}$ 进行归纳，来定义一系列的 **k-阶项集** $T_k$ 和 **k-阶合式公式集** $F_k$。

**(a) 基础层定义 ($k=0$)**

1.  **第0阶项集 ($T_0$):**
    $T_0 \triangleq V_I$

2.  **第0阶合式公式集 ($F_0$)的归纳定义:**
    i.   **基础情况 (原子公式):** 如果 $P^n \in V_P^n$ 且 $t_1, \dots, t_n \in T_0$，则 $P^n(t_1, \dots, t_n) \in F_0$。
    ii.  **归纳步骤 (复合与量化):**
        *   如果 $\Phi \in F_0$，则 $(¬\Phi) \in F_0$。
        *   如果 $\Phi, \Psi \in F_0$，则 $(\Phi \rightarrow \Psi) \in F_0$。
        *   如果 $\Phi \in F_0$ 且 $v$ 是任意变量 (即 $v \in V_I \cup \bigcup_{n \geq 1} V_P^n$)，则 $(∀v \Phi) \in F_0$。
    iii. **闭包:** $F_0$ 是满足 i 和 ii 的最小集合。

**(b) 归纳层定义 ($k > 0$)**

假设对于所有 $j < k$，$T_j$ 和 $F_j$ 均已定义。我们定义 $T_k$ 和 $F_k$ 如下：

1.  **第k阶项集 ($T_k$):**
    $T_k \triangleq V_I \cup F_{k-1}$

2.  **第k阶合式公式集 ($F_k$)的归纳定义:**
    i.   **基础情况 (原子公式):** 如果 $P^n \in V_P^n$ 且 $t_1, \dots, t_n \in T_k$，则 $P^n(t_1, \dots, t_n) \in F_k$。
    ii.  **归纳步骤 (复合与量化):**
        *   如果 $\Phi \in F_k$，则 $(¬\Phi) \in F_k$。
        *   如果 $\Phi, \Psi \in F_k$，则 $(\Phi \rightarrow \Psi) \in F_k$。
        *   如果 $\Phi \in F_k$ 且 $v$ 是任意变量，则 $(∀v \Phi) \in F_k$。
    iii. **闭包:** $F_k$ 是满足 i 和 ii 的最小集合。

**(c) 项与合式公式的最终定义**

1.  **项 (Term):** 一个表达式 $t$ 是一个 **项**，当且仅当存在一个自然数 $k \in \mathbb{N}$，使得 $t \in T_k$。形式上，项的集合 $\mathcal{T}$ 定义为：
    $$ \mathcal{T} \triangleq \bigcup_{k=0}^{\infty} T_k $$
2.  **合式公式 (Well-Formed Formula, WFF):** 一个表达式 $\Phi$ 是一个 **合式公式**，当且仅当存在一个自然数 $k \in \mathbb{N}$，使得 $\Phi \in F_k$。形式上，合式公式的集合 $\mathcal{F}$ 定义为：
    $$ \mathcal{F} \triangleq \bigcup_{k=0}^{\infty} F_k $$

*注：根据以上定义，易知对于任意 $k \in \mathbb{N}$，有 $T_k \subseteq T_{k+1}$ 且 $F_k \subseteq F_{k+1}$。该分层定义确保了任何表达式的子表达式都属于一个更低或相等的阶，从而为结构归纳提供了良基基础。*

##### **1.3 辅助定义 (Abbreviations)**

为了表达的便利性，我们引入以下标准定义：

*   $(Φ ∧ Ψ)$ 定义为 $¬(Φ → ¬Ψ)$
*   $(Φ ∨ Ψ)$ 定义为 $(¬Φ → Ψ)$
*   $(Φ ↔ Ψ)$ 定义为 $((Φ → Ψ) ∧ (Ψ → Φ))$
*   $(∃v Φ)$ 定义为 $¬(∀v ¬Φ)$

##### **1.4 自由变量 (Free Variables)**

我们首先递归地定义一个表达式 $e$（可以是项或 WFF）中的**自由变量集** $FV(e)$。

1.  **变量:** 如果 $v$ 是一个变量（个体或谓词），则 $FV(v) = \{v\}$。
2.  **原子公式:** 如果 $Φ$ 是原子公式 $P^n(t₁, ..., tₙ)$，则 $FV(Φ) = FV(P^n) ∪ FV(t₁) ∪ ... ∪ FV(tₙ)$。
    *   *注意：* 由于项 $tᵢ$ 本身可以是复杂的 WFF，此定义是递归的。
3.  **复合公式:**
    *   $FV((¬Φ)) = FV(Φ)$
    *   $FV((Φ → Ψ)) = FV(Φ) ∪ FV(Ψ)$
4.  **量化公式:** 如果 $Φ$ 是 $(∀v Ψ)$，则 $FV(Φ) = FV(Ψ) \setminus \{v\}$。（从 $Ψ$ 的自由变量集中移除被量词 $∀v$ 绑定的变量 $v$）。

如果一个变量 $v$ 在 $Φ$ 中的某次出现不位于任何 $∀v$ 量词的作用域内，则称 $v$ 在 $Φ$ 中有一次**自由出现**。$v ∈ FV(Φ)$ 当且仅当 $v$ 在 $Φ$ 中至少有一次自由出现。

##### **1.5 可代入性 (Substitutability)**

我们现在定义“项 $t$ 对于变量 $v$ 在 WFF $Φ$ 中是**可代入的**（substitutable）”。其直观含义是：将 $Φ$ 中所有 $v$ 的自由出现替换为 $t$ 后，$t$ 中的任何自由变量都不会被 $Φ$ 中原有的量词所捕获。

该定义通过对 $Φ$ 的结构进行递归来给出：

1.  **原子公式:** 如果 $Φ$ 是一个原子公式，则 $t$ 对于 $v$ 在 $Φ$ 中总是可代入的。

2.  **复合公式:**
    *   $t$ 对于 $v$ 在 $(¬Ψ)$ 中是可代入的，当且仅当 $t$ 对于 $v$ 在 $Ψ$ 中是可代入的。
    *   $t$ 对于 $v$ 在 $(Φ → Ψ)$ 中是可代入的，当且仅当 $t$ 对于 $v$ 在 $Φ$ 中是可代入的，并且对于 $v$ 在 $Ψ$ 中也是可代入的。

3.  **量化公式:** 如果 $Φ$ 是 $(∀u Ψ)$，其中 $u$ 是任意变量（个体或谓词），则 $t$ 对于 $v$ 在 $Φ$ 中是可代入的，当且仅当满足以下**至少一个**条件：
    *   **(a)** $v$ 在 $Ψ$ 中没有自由出现（即 $v ∉ FV(Ψ)$）；
    *   **(b)** $u$ 与 $v$ 是同一个变量（即 $u ≡ v$）；
    *   **(c)** $u$ 不是 $t$ 的自由变量（即 $u ∉ FV(t)$），并且 $t$ 对于 $v$ 在 $Ψ$ 中是可代入的。

---
##### **1.6 唯一可读性定理 (Unique Readability Theorem)**

本节的目的是证明系统 $L_I$ 的语法是无歧义的。我们将证明任何表达式（项或合式公式）只能以一种方式从其直接构成成分构建而来。证明将通过对表达式（作为字符串）的长度进行强归纳来完成。

**定义 1.6.1 (表达式与括号差额)**

1.  **表达式 (Expression):** 令表达式集合 $\mathcal{E} \triangleq \mathcal{T} \cup \mathcal{F}$，即所有项和合式公式的并集。
2.  **括号差额 (Bracket Difference):** 对于任意字符串 $S$，令 $N_L(S)$ 和 $N_R(S)$ 分别表示 $S$ 中左括号 `(` 和右括号 `)` 的数量。定义 $S$ 的括号差额为 $\delta(S) \triangleq N_L(S) - N_R(S)$。
3.  **技术性假定:** 为保证词法分析的明确性，我们假定字母表中的任何变量（个体或谓词）都不是另一个变量的真初始段 (proper initial segment)。

**引理 1.6.2 (括号性质)**

1.  对于任意合式公式 $\Phi \in \mathcal{F}$，$\Phi$ 是**括号平衡的**，即 $\delta(\Phi) = 0$。
2.  若 $\Phi \in \mathcal{F}$ 是形如 `(S)` 的复合公式或量化公式，则对于 $\Phi$ 的任何真初始段 $\Phi'$，有 $\delta(\Phi') > 0$。

**证明：**
我们对合式公式 $\Phi$ 的长度 $n$ 进行强归纳。
**归纳假设 (IH):** 假设对于任何长度小于 $n$ 的合式公式，此引理的两个论断均成立。

**归纳步骤：** 考虑一个长度为 $n$ 的合式公式 $\Phi$。

*   **基础情况: $\Phi$ 是原子公式 $P^k(t_1, \dots, t_k)$。**
    1.  **论断 (1):** 任何项 $t_i$ 自身的长度都小于 $n$。若 $t_i$ 是一个变量，则 $\delta(t_i)=0$。若 $t_i$ 是一个合式公式，根据归纳假设，$\delta(t_i)=0$。因此，所有项都是括号平衡的。那么，$\delta(\Phi) = \delta(P^k) + \delta('(') + \sum_{i=1}^k \delta(t_i) + (k-1)\delta(',') + \delta(')') = 0 + 1 + \sum_{i=1}^k 0 + 0 - 1 = 0$。论断 (1) 成立。
    2.  **论断 (2):** 此情况不适用，因为原子公式不以 `(` 开头。

*   **归纳步骤: $\Phi$ 是复合或量化公式。** $\Phi$ 必然具有 `(S)` 的形式。
    1.  **论断 (1):**
        *   若 $\Phi = (\neg\Psi)$: $\Psi$ 的长度小于 $n$。根据 IH，$\delta(\Psi) = 0$。因此 $\delta(\Phi) = 1 + \delta(\neg) + \delta(\Psi) - 1 = 1 + 0 + 0 - 1 = 0$。
        *   若 $\Phi = (\Psi \to \Xi)$: $\Psi$ 和 $\Xi$ 的长度均小于 $n$。根据 IH，$\delta(\Psi) = \delta(\Xi) = 0$。因此 $\delta(\Phi) = 1 + \delta(\Psi) + \delta(\to) + \delta(\Xi) - 1 = 1+0+0+0-1 = 0$。
        *   若 $\Phi = (\forall v \Psi)$: $\Psi$ 的长度小于 $n$。根据 IH，$\delta(\Psi) = 0$。$\delta(v)=0$。因此 $\delta(\Phi) = 1 + \delta(\forall) + \delta(v) + \delta(\Psi) - 1 = 1+0+0+0-1=0$。
        论断 (1) 在所有情况下均成立。

    2.  **论断 (2):** 令 $\Phi' = (S')$ 是 $\Phi = (S)$ 的一个真初始段。
        *   由于 $\Phi'$ 是真初始段，它至少包含第一个 `(`。若 $\Phi'$ 长度为 1，则 $\Phi' = ($，$\delta(\Phi')=1 > 0$。
        *   若 $\Phi'$ 长度大于 1，则 $\Phi' = (S'$，其中 $S'$ 是 $S$ 的一个真初始段。
            *   若 $\Phi = (\neg\Psi)$，则 $S = \neg\Psi$。$S'$ 可能是 `¬` 或 `¬\Psi'`（$\Psi'$ 是 $\Psi$ 的初始段）。$\delta((S')) = 1 + \delta(S')$。若 $S'=\neg$, $\delta((S'))=1>0$。若 $S'=\neg\Psi'$, $\delta(S')=\delta(\Psi')$。若 $\Psi'$ 是 $\Psi$ 的真初始段且 $\Psi$ 是复合公式，由 IH，$\delta(\Psi')>0$。若 $\Psi$ 是原子公式，其任何初始段的括号差额非负。故 $\delta((S')) = 1 + \delta(\Psi') \ge 1 > 0$。
            *   若 $\Phi = (\Psi \to \Xi)$，则 $S=\Psi\to\Xi$。$S'$ 可能是 $\Psi$ 的初始段、$\Psi$、$\Psi\to$ 或 $\Psi\to\Xi'$。在所有这些情况下，利用 IH 于 $\Psi$ 和 $\Xi$ 可以证明 $\delta(S') \ge 0$。因此 $\delta((S')) = 1 + \delta(S') > 0$。
            *   若 $\Phi = (\forall v \Psi)$，同理可证。
        论断 (2) 在所有情况下均成立。

归纳完成，引理得证。

**引理 1.6.3 (非前缀性)**
没有一个表达式 $e_1 \in \mathcal{E}$ 是另一个表达式 $e_2 \in \mathcal{E}$ 的真初始段。

**证明：**
为寻求矛盾，假设 $e_1$ 是 $e_2$ 的真初始段。我们对 $e_1$ 的结构进行分类讨论。

*   **情况 1: $e_1$ 是一个变量。** 根据定义 1.6.1(3)，$e_1$ 不能是另一个变量的真初始段。而任何非变量表达式都以谓词变量或 `(` 开头，变量 $e_1$ 不可能是它们的初始段。故此情况不可能发生。

*   **情况 2: $e_1$ 是原子公式 $P^k(t_1, \dots, t_k)$。** $e_1$ 以一个谓词变量开头，以 `)` 结尾。任何形成规则都不允许在一个完整的、合法的表达式之后附加任何符号来形成一个新的、合法的表达式。因此，$e_2$ 不可能是 $\mathcal{E}$ 中的元素。这与假设矛盾。

*   **情况 3: $e_1$ 是复合或量化公式，形如 `(S)`。**
    1.  根据引理 1.6.2(1)，我们有 $\delta(e_1)=0$。
    2.  由于 $e_1$ 以 `(` 开头，而 $e_1$ 是 $e_2$ 的初始段，所以 $e_2$ 也必须以 `(` 开头。因此，$e_2$ 只能是复合或量化公式。
    3.  但 $e_1$ 是 $e_2$ 的一个真初始段。根据引理 1.6.2(2) 应用于 $e_2$，必须有 $\delta(e_1) > 0$。
    4.  这与 $\delta(e_1)=0$ 直接矛盾。故此情况不可能发生。

所有情况均导出矛盾，因此该引理得证。

**定理 1.6.4 (唯一可读性)**
任何表达式 $e \in \mathcal{E}$ 都可以被唯一地分解为其直接构成成分。

**证明：**
我们对表达式 $e$ 的长度 $n$ 进行强归纳。
**归纳假设 (IH):** 任何长度小于 $n$ 的表达式都具有唯一的分解。

**归纳步骤：** 考虑一个长度为 $n$ 的表达式 $e$。我们对其第一个符号进行分类讨论。

*   **情况 1: $e$ 的第一个符号是变量。**
    *   **子情况 1.1: $e$ 是个体变量 $v \in V_I$。** 根据形成规则，$e$ 只能是该变量本身。它没有构成成分，其分解（即其自身）是唯一的。
    *   **子情况 1.2: $e$ 是谓词变量 $P^k \in V_P^k$。** 根据形成规则，$e$ 必须是原子公式 $P^k(t_1, \dots, t_k)$。它不可能是任何以 `(` 开头的其他形式。因此其**类型**是唯一确定的。
        现在证明其构成成分 $t_1, \dots, t_k$ 是唯一的。假设存在两种分解：$e = P^k(t_1, \dots, t_k)$ 和 $e = P^k(t'_1, \dots, t'_k)$。这意味着字符串 $t_1, \dots, t_k$ 与 $t'_1, \dots, t'_k$ 完全相同。若 $t_1 \not\equiv t'_1$，则其中一个必然是另一个的真初始段。然而，$t_1$ 和 $t'_1$ 本身都是表达式，其长度小于 $n$。这违反了引理 1.6.3 (非前缀性)。因此，必然有 $t_1 \equiv t'_1$。
        既然 $t_1$ 被唯一确定，我们可以从参数串中移除 `t_1` (以及随后的逗号，如果存在)，然后对剩余的字符串重复此论证，从而唯一地确定 $t_2, \dots, t_k$。根据 IH，每个 $t_i$ 自身也是唯一可读的。因此，分解是唯一的。

*   **情况 2: $e$ 的第一个符号是 `(`。** 则 $e$ 必为 $(\neg\Psi)$, $(\Psi \to \Xi)$ 或 $(\forall v \Psi)$ 之一。令 $e = (S)$。我们考察 $S$ 的第一个符号。
    *   **子情况 2.1: $S$ 以 `¬` 开头。** 则 $e$ 必须是 $(\neg\Psi)$ 的形式。它不可能是 $(\Psi' \to \Xi)$ 或 $(\forall v \Psi')$，因为 `¬` 符号本身不是一个合法的表达式。因此类型是唯一的。$\Psi$ 被唯一确定为 $S$ 除去 `¬` 之后的部分。由于 $\Psi$ 的长度小于 $n$，根据 IH，$\Psi$ 是唯一可读的。
    *   **子情况 2.2: $S$ 以 `∀` 开头。** 同理，$e$ 必须是 $(\forall v \Psi)$ 的形式。变量 $v$ 和公式 $\Psi$ 都是作为字符串被唯一确定的。根据 IH，$\Psi$ 是唯一可读的。
    *   **子情况 2.3: $S$ 以一个表达式的起始符号开头（即一个变量或 `(`）。** 则 $e$ 必须是 $(\Psi \to \Xi)$ 的形式。类型是唯一的。
        假设存在两种分解：$e = (\Psi_1 \to \Xi_1)$ 和 $e = (\Psi_2 \to \Xi_2)$。这表示字符串 $\Psi_1 \to \Xi_1$ 与 $\Psi_2 \to \Xi_2$ 完全相同。若 $\Psi_1 \not\equiv \Psi_2$，则一个必为另一个的真初始段。但 $\Psi_1$ 和 $\Psi_2$ 都是表达式，这再次违反了引理 1.6.3 (非前缀性)。因此，必然有 $\Psi_1 \equiv \Psi_2$。这直接蕴含了 $\Xi_1 \equiv \Xi_2$。分解是唯一的。根据 IH，$\Psi_1$ 和 $\Xi_1$ 自身都是唯一可读的。

所有情况都导向唯一的分解。归纳完成，定理得证。

#### 2. 公理系统 (Axiomatic System)

L_I 的公理系统由以下公理模式和一条推理规则组成。其中 $Φ$, $Ψ$, $Ξ$ 代表任意合式公式。

**2.1 公理模式 (Axiom Schemata)**

*   **(A1) 蕴含公理 1:** $Φ → (Ψ → Φ)$
*   **(A2) 蕴含公理 2:** $(Φ → (Ψ → Ξ)) → ((Φ → Ψ) → (Φ → Ξ))$
*   **(A3) 逆否公理:** $(¬Ψ → ¬Φ) → (Φ → Ψ)$
*   **(A4) 全称量词分配律:** $(∀v (Φ → Ψ)) → ((∀v Φ) → (∀v Ψ))$
*   **(A5a) 个体变量实例化 (Instantiation for Individual Variables):**
    $$
    (\forall x \Phi) \rightarrow \Phi[t/x]
    $$
    *   其中 $x$ 是一个**个体变量** ($x ∈ V_I$)。
    *   $t$ 是一个**项**。根据 $L_I$ 的语法，$t$ 可以是任何个体变量或任何合式公式。
    *   $t$ 对于 $x$ 在 $Φ$ 中必须是**可代入的**（根据我们之前补充的严格定义）。

*   **(A5b) 谓词变量实例化 (Instantiation for Predicate Variables):**
    $$
    (\forall P^n \Phi) \rightarrow \Phi[Q^n/P^n]
    $$
    *   其中 $P^n$ 是一个 $n$ 元**谓词变量** ($P^n ∈ V_P^n$)。
    *   $Q^n$ 是**另一个** $n$ 元**谓词变量** ($Q^n ∈ V_P^n$)。
    *   $Q^n$ 对于 $P^n$ 在 $Φ$ 中必须是**可代入的**。

*   **(A6) 全称量词泛化:** 如果 $v$ 在 $Φ$ 中没有自由出现，则 $Φ → (∀v Φ)$。

**2.2 推理规则 (Rule of Inference)**

*   **分离规则 (Modus Ponens, MP):**
    从 $Φ$ 和 $(Φ → Ψ)$，可以推导出 $Ψ$。

#### 3. 特殊公理：内外互换律 (The Inter-External Exchange Law)

**内外互换公理1 (Axiom of Inter-External Exchange, AIE1):**

对于任意二元谓词变量 $P$ 和 $Q$，以及任意个体变量 $x, y, z$：
$$
\forall P \forall Q \ \forall x \forall y \forall z \ ( Q(P(x, y), z) \leftrightarrow P(Q(x, y),z) )
$$

**内外互换公理2 (Axiom of Inter-External Exchange, AIE2):**

对于任意二元谓词变量 $P$ 和 $Q$，以及任意个体变量 $x, y, z$：
$$
\forall P \forall Q \ \forall x \forall y \forall z \ ( Q(x, P(y, z)) \leftrightarrow P(x, Q(y, z)) )
$$

---

#### **4. 代数语义与可靠性 (Algebraic Semantics and Soundness)**

本节为形式系统 $L_I$ 提供一个严格的代数语义。此语义旨在为所有语法结构（特别是量词）提供一个统一且和谐的解释，并在此基础上，严谨地证明逻辑系统 $L_I$ 的可靠性。

##### **4.1 $L_I$ 的代数语义**

###### **4.1.1 模型 (Model)**

一个 $L_I$ 的**代数模型 (Algebraic Model)** $\mathcal{M}$ 是一个三元组 $\mathcal{M} = \langle \mathcal{A}, D_I, \{\mathcal{P}_n\}_{n \ge 1} \rangle$，其中：

1.  **真值代数 (Truth-Value Algebra):** $\mathcal{A} = \langle D, \wedge, \vee, \to, \perp, \top \rangle$ 是一个**完全布尔代数 (Complete Boolean Algebra, CBA)**。
    *   $D$ 是一个非空集合，称为真值域。
    *   $\langle D, \le \rangle$ 是一个由 $d_1 \le d_2 \iff d_1 \wedge d_2 = d_1$ 定义的完全格。这意味着 $D$ 的任何子集都有一个**下确界 (infimum, $\inf$)** 和一个**上确界 (supremum, $\sup$)**。
    *   $\to$ 是蕴含算子，定义为 $d_1 \to d_2 \triangleq (\neg d_1) \vee d_2$，其中 $\neg d_1 \triangleq d_1 \to \perp$。
    *   $\top$ 是最大元，$\perp$ 是最小元。

2.  **个体论域 (Domain of Individuals):** $D_I$ 是一个非空集合。为简化表示，我们要求 $D_I = D$。

3.  **谓词解释域 (Domains for Predicate Variables):** 对每一个元数 $n \ge 1$，$\mathcal{P}_n$ 是一个由从 $D_I^n$ 映至 $D$ 的函数构成的非空集合。

###### **4.1.2 逻辑符号的解释**

模型 $\mathcal{M}$ 的代数结构 $\mathcal{A}$ 直接解释了逻辑联结词：
*   **蕴含 (Implication):** 解释为代数中的 $\to$ 算子。
*   **否定 (Negation):** 解释为代数中的 $\neg$ 算子，即 $d \mapsto (d \to \perp)$。

###### **4.1.3 变量赋值与语义值**

一个**变量赋值 (Variable Assignment)** $g$ 是一个函数，其定义域为所有变量的集合 $V_I \cup (\bigcup_{n\ge 1} V_P^n)$，并满足：
*   如果 $x \in V_I$，则 $g(x) \in D_I$。
*   如果 $P^n \in V_P^n$，则 $g(P^n) \in \mathcal{P}_n$。

给定模型 $\mathcal{M}$ 和赋值 $g$，我们通过对表达式 $e$ 的结构进行递归，定义其**语义值 (semantic value)** $⟦e⟧_g \in D$。

**(A) 项的语义值**
1.  若 $t$ 是个体变量 $x$，则 $⟦t⟧_g \triangleq g(x)$。
2.  若 $t$ 是合式公式 $\Phi$，则 $⟦t⟧_g \triangleq ⟦\Phi⟧_g$。

**(B) 合式公式的语义值**
1.  **原子公式:** 若 $\Phi$ 是 $P^n(t_1, ..., t_n)$，则 $⟦\Phi⟧_g \triangleq g(P^n)(⟦t_1⟧_g, ..., ⟦t_n⟧_g)$。
2.  **复合公式:**
    *   $⟦\neg\Psi⟧_g \triangleq \neg ⟦\Psi⟧_g$。
    *   $⟦(\Psi \to \Xi)⟧_g \triangleq ⟦\Psi⟧_g \to ⟦\Xi⟧_g$。
3.  **量化公式:**
    *   若 $\Phi$ 是 $(\forall x \Phi')$ (其中 $x \in V_I$)，则：
        $$
        ⟦\forall x \Phi'⟧_g \triangleq \inf \{ ⟦\Phi'⟧_{g[x/d]} \mid d \in D_I \}
        $$
    *   若 $\Phi$ 是 $(\forall P^n \Phi')$ (其中 $P^n \in V_P^n$)，则：
        $$
        ⟦\forall P^n \Phi'⟧_g \triangleq \inf \{ ⟦\Phi'⟧_{g[P^n/p]} \mid p \in \mathcal{P}_n \}
        $$
    其中 $g[v/d]$ 表示一个与 $g$ 几乎处处相同，仅在变量 $v$ 处取值为 $d$ 的新赋值。

###### **4.1.4 满足与有效性**

*   **满足 (Satisfaction):** 一个公式 $\Phi$ 在模型 $\mathcal{M}$ 中对于赋值 $g$ 是**真**的，记作 $\mathcal{M}, g \models \Phi$，当且仅当 $⟦\Phi⟧_g = \top$。
*   **有效性 (Validity):** 一个公式 $\Phi$ 是**有效**的，记作 $\models \Phi$，当且仅当对于所有模型 $\mathcal{M}$ 和所有变量赋值 $g$，都有 $\mathcal{M}, g \models \Phi$。

##### **4.2 关键引理**

**引理 4.2.1 (下确界与最大元)**
在任何完全格中，对于任意非空子集 $S \subseteq D$，$\inf(S) = \top$ 当且仅当对于所有 $s \in S$，$s = \top$。
**证明:**
(⇒) 假设 $\inf(S) = \top$。根据下确界的定义，对于任意 $s \in S$，$\inf(S) \le s$。因此 $\top \le s$。由于 $\top$ 是 $D$ 中的最大元，必然有 $s=\top$。
(⇐) 假设对于所有 $s \in S$，$s=\top$。那么集合 $S$ 是单例集 $\{\top\}$。故 $\inf(S) = \inf(\{\top\}) = \top$。

**引理 4.2.2 (语义相关性)**
若变量 $v$ 在表达式 $e$ 中没有自由出现 ($v \notin FV(e)$)，则对于任意赋值 $g$ 和任意值 $d$（在 $v$ 的对应域中），$⟦e⟧_g = ⟦e⟧_{g[v/d]}$。
**证明:** 对表达式 $e$ 的结构进行标准归纳。基础情况为变量，归纳步骤覆盖原子公式、复合公式和量化公式。对于量化公式 $(\forall u \Phi)$，当 $u \not\equiv v$ 时，根据归纳假设，结论成立；当 $u \equiv v$ 时， $v$ 在 $(\forall v \Phi)$ 中无自由出现，结论平凡成立。

**引理 4.2.3 (代入引理)**
令 $v$ 为任意变量，$t$ 为任意项。若 $t$ 对于 $v$ 在表达式 $e$ 中是可代入的，则对于任意变量赋值 $g$：
$$⟦e[t/v]⟧_g = ⟦e⟧_{g[v/⟦t⟧_g]}$$

**证明：**
对表达式 $e$ 的结构进行归纳。令 $g' \triangleq g[v/⟦t⟧_g]$。

*   **基础情况：$e$ 是变量 $u$。**
    *   若 $u \equiv v$，则 $e[t/v] = t$。LHS = $⟦t⟧_g$。RHS = $⟦v⟧_{g'} = g'(v) = ⟦t⟧_g$。等式成立。
    *   若 $u \not\equiv v$，则 $e[t/v] = u$。LHS = $⟦u⟧_g = g(u)$。RHS = $⟦u⟧_{g'} = g'(u) = g(u)$。等式成立。

*   **归纳步骤：** 假设引理对 $e$ 的所有直接构成成分成立。

    *   **情况 1：$e = P^n(t_1, \dots, t_n)$。**
        $e[t/v] = P^n[t/v](t_1[t/v], \dots, t_n[t/v])$。
        LHS = $⟦(P^n[t/v])(t_1[t/v], \dots, t_n[t/v])⟧_g = ⟦P^n[t/v]⟧_g (⟦t_1[t/v]⟧_g, \dots, ⟦t_n[t/v]⟧_g)$。
        RHS = $⟦P^n(t_1, \dots, t_n)⟧_{g'} = g'(P^n)(⟦t_1⟧_{g'}, \dots, ⟦t_n⟧_{g'})$。
        根据归纳假设应用于项 $t_i$，$⟦t_i[t/v]⟧_g = ⟦t_i⟧_{g'}$。我们只需证明 $⟦P^n[t/v]⟧_g = g'(P^n)$。
        若 $v$ 不是 $P^n$，则 $P^n[t/v] = P^n$，LHS 的函数部分为 $g(P^n)$，RHS 的函数部分为 $g'(P^n) = g(P^n)$，相等。
        若 $v \equiv P^n$，则 $P^n[t/v]=t$（$t$ 必须是 $n$ 元谓词变量或能产生 $n$ 元谓词语义对象的项）。LHS 的函数部分为 $⟦t⟧_g$。RHS 的函数部分为 $g'(P^n) = g[P^n/⟦t⟧_g](P^n) = ⟦t⟧_g$。相等。
        故 LHS = RHS。

    *   **情况 2：$e = (\neg\Phi)$ 或 $e = (\Phi \to \Psi)$。**
        对于否定式，$e[t/v] = (\neg\Phi[t/v])$。LHS = $\neg ⟦\Phi[t/v]⟧_g$。RHS = $\neg ⟦\Phi⟧_{g'}$。根据归纳假设 $⟦\Phi[t/v]⟧_g = ⟦\Phi⟧_{g'}$，故 LHS = RHS。蕴含式同理。

    *   **情况 3：$e = (\forall u \Phi)$。**
        *   **子情况 3.1：$u \equiv v$。**
            $e[t/v] = e$。LHS = $⟦e⟧_g$。$v$ 在 $e$ 中没有自由出现，根据引理 4.2.2 (语义相关性)，$⟦e⟧_g = ⟦e⟧_{g'}$。LHS = RHS。

        *   **子情况 3.2：$u \not\equiv v$。**
            $e[t/v] = (\forall u (\Phi[t/v]))$。可代入性条件保证了 (a) $v \notin FV(\Phi)$ 或 (c) $u \notin FV(t)$ 且 $t$ 对 $v$ 在 $\Phi$ 中可代入。
            LHS = $\inf \{ ⟦\Phi[t/v]⟧_{g[u/d]} \mid d \in \text{Dom}(u) \}$。
            RHS = $\inf \{ ⟦\Phi⟧_{g'[u/d]} \mid d \in \text{Dom}(u) \}$。
            我们只需证明对于任意 $d \in \text{Dom}(u)$，有 $⟦\Phi[t/v]⟧_{g[u/d]} = ⟦\Phi⟧_{g'[u/d]}$。
            令 $g_d = g[u/d]$。根据归纳假设应用于 $\Phi$ 和赋值 $g_d$：$⟦\Phi[t/v]⟧_{g_d} = ⟦\Phi⟧_{g_d[v/⟦t⟧_{g_d}]}$。
            由于 $u \notin FV(t)$ (可代入性条件 (c)) 或 $v \notin FV(\Phi)$ (条件 (a)，此时 $t$ 的自由变量不重要)，我们有 $⟦t⟧_{g_d} = ⟦t⟧_{g[u/d]} = ⟦t⟧_g$ (根据引理 4.2.2)。
            因此 $g_d[v/⟦t⟧_{g_d}] = (g[u/d])[v/⟦t⟧_g]$。又因 $u \not\equiv v$，赋值顺序可交换，故 $(g[u/d])[v/⟦t⟧_g] = (g[v/⟦t⟧_g])[u/d] = g'[u/d]$。所以 $⟦\Phi[t/v]⟧_{g[u/d]} = ⟦\Phi⟧_{g'[u/d]}$。
            被求下确界的两个集合逐点相等，故它们的下确界也相等。LHS = RHS。
引理得证。

##### **4.3 可靠性 (Soundness)**

**定理 4.3.1 (可靠性)**
如果 $\vdash_{L_I} \Phi$，那么 $\models \Phi$。

**证明:**
对证明的长度 $k$ 进行归纳。

**归纳基础 (k=1):** $\Phi$ 是一个公理。我们必须证明对于任意模型 $\mathcal{M}$ 和赋值 $g$，$⟦\Phi⟧_g = \top$。

*   **(A1)-(A3):** $Φ → (Ψ → Φ)$, $(Φ → (Ψ → Ξ)) → ((Φ → Ψ) → (Φ → Ξ))$, $(¬Ψ → ¬Φ) → (Φ → Ψ)$。
    这些公理模式是经典命题逻辑的重言式。在任何布尔代数中，这些模式对应的代数恒等式都成立。例如，对 A1，我们需要证明 $a \to (b \to a) = \top$，这等价于 $a \le (b \to a)$, 即 $a \wedge b \le a$，此为真。A2 和 A3 同理可证。

*   **(A4) $(\forall v (Φ \to \Psi)) \to ((\forall v Φ) \to (\forall v \Psi))$**
    我们需要证明 $⟦\forall v (Φ \to \Psi)⟧_g \le ⟦(\forall v Φ) \to (\forall v \Psi)⟧_g$。
    令 $A_d = ⟦Φ⟧_{g[v/d]}$，$B_d = ⟦Ψ⟧_{g[v/d]}$。我们需要证明：
    $\inf_d (A_d \to B_d) \le (\inf_d A_d) \to (\inf_d B_d)$。
    在任何完全海廷代数（因此在任何完全布尔代数）中，此不等式成立。证明如下：
    1.  令 $C = \inf_d (A_d \to B_d)$ 和 $A = \inf_d A_d$。
    2.  根据海廷蕴含的性质（伴随性），要证明 $C \le A \to (\inf_d B_d)$，只需证明 $C \wedge A \le \inf_d B_d$。
    3.  $C \wedge A = (\inf_d (A_d \to B_d)) \wedge (\inf_d A_d)$。
    4.  对于任意 $d_0 \in \text{Dom}(v)$，我们有 $C \le A_{d_0} \to B_{d_0}$ 且 $A \le A_{d_0}$。
    5.  因此 $C \wedge A \le (A_{d_0} \to B_{d_0}) \wedge A_{d_0}$。
    6.  在海廷代数中， modus ponens 成立，即 $p \wedge (p \to q) \le q$。所以 $(A_{d_0} \to B_{d_0}) \wedge A_{d_0} \le B_{d_0}$。
    7.  结合 (5) 和 (6)，我们得到 $C \wedge A \le B_{d_0}$。
    8.  由于 $d_0$ 是任意的，所以 $C \wedge A$ 是集合 $\{B_d \mid d \in \text{Dom}(v)\}$ 的一个下界。
    9.  根据下确界的定义， $C \wedge A \le \inf_d B_d$。证明完毕。

*   **(A5a) $(\forall x \Phi) \to \Phi[t/x]$**
    需证明 $⟦\forall x \Phi⟧_g \le ⟦\Phi[t/x]⟧_g$。
    1.  令 $d_t = ⟦t⟧_g \in D_I$。
    2.  根据量词语义，$⟦\forall x \Phi⟧_g = \inf \{ ⟦\Phi⟧_{g[x/d]} \mid d \in D_I \}$。
    3.  根据下确界的定义，$\inf \{ ⟦\Phi⟧_{g[x/d]} \mid d \in D_I \} \le ⟦\Phi⟧_{g[x/d_t]}$。
    4.  根据引理 4.2.3 (代入引理)，$⟦\Phi[t/x]⟧_g = ⟦\Phi⟧_{g[x/⟦t⟧_g]} = ⟦\Phi⟧_{g[x/d_t]}$。
    5.  结合 (2), (3), (4)，可得 $⟦\forall x \Phi⟧_g \le ⟦\Phi[t/x]⟧_g$。

*   **(A5b) $(\forall P^n \Phi) \to \Phi[Q^n/P^n]$**
    证明与 A5a 完全同构，只需将论域从 $D_I$ 替换为 $\mathcal{P}_n$。

*   **(A6) $Φ \to (\forall v Φ)$，其中 $v \notin FV(\Phi)$**
    需证明 $⟦Φ⟧_g \le ⟦\forall v Φ⟧_g$。
    1.  根据引理 4.2.2 (语义相关性)，由于 $v \notin FV(Φ)$，对任意 $d \in \text{Dom}(v)$，有 $⟦Φ⟧_g = ⟦Φ⟧_{g[v/d]}$。
    2.  因此，集合 $\{ ⟦Φ⟧_{g[v/d]} \mid d \in \text{Dom}(v) \}$ 是单例集 $\{ ⟦Φ⟧_g \}$。
    3.  $⟦\forall v Φ⟧_g = \inf \{ ⟦Φ⟧_{g[v/d]} \mid d \in \text{Dom}(v) \} = \inf \{ ⟦Φ⟧_g \} = ⟦Φ⟧_g$。
    4.  根据偏序的自反性，$⟦Φ⟧_g \le ⟦Φ⟧_g$ 成立。

**归纳步骤:** 假设所有长度小于 $k$ 的证明所导出的公式都是有效的。令 $\Phi$ 是在第 $k$ 步由分离规则从 $\Phi_i$ 和 $(\Phi_i \to \Phi)$ 推导而来。
1.  归纳假设: $\models \Phi_i$ 且 $\models (\Phi_i \to \Phi)$。
2.  这意味着对于任意模型 $\mathcal{M}$ 和赋值 $g$，$⟦\Phi_i⟧_g = \top$ 且 $⟦\Phi_i \to \Phi⟧_g = \top$。
3.  $⟦\Phi_i \to \Phi⟧_g = ⟦\Phi_i⟧_g \to ⟦\Phi⟧_g = \top \to ⟦\Phi⟧_g = \top$。
4.  在布尔代数中，$\top \to d = \top$ 当且仅当 $d = \top$。
5.  因此 $⟦\Phi⟧_g = \top$。故 $\models \Phi$。

归纳完成。定理得证。

##### **4.4 一致性模型**

为证明系统 $L_I$ 的一致性（即不能证明 $\perp$），我们构造一个满足所有公理（包括 AIE1, AIE2）的非平凡模型 $\mathcal{M}_C$。

**4.4.1 模型定义**

$\mathcal{M}_C = \langle \mathcal{A}, D_I, \{\mathcal{P}_n\}_{n \ge 1} \rangle$，其中：

1.  **真值代数 (Truth-Value Algebra):** $\mathcal{A}$ 是两元布尔代数，其真值域 $D = \{0, 1\}$，其中 $0=\perp, 1=\top$。这是一个完备布尔代数。
2.  **个体论域 (Domain of Individuals):** $D_I = D = \{0, 1\}$。
3.  **谓词解释域 (Domains for Predicate Variables):**
    对于每个元数 $n \ge 1$，定义 $\mathcal{P}_n$ 为由参数化的函数族构成的集合：
    $$ \mathcal{P}_n \triangleq \{ p_{c,n} : D_I^n \to D \mid c \in \{0, 1\} \} $$
    其中函数 $p_{c,n}$ 定义为：
    $$ p_{c,n}(d_1, \dots, d_n) \triangleq c \wedge d_1 \wedge \dots \wedge d_n \quad (\text{逻辑与}) $$
    
**4.4.2 特殊公理有效性验证**
公理 A1-A6 的有效性已在可靠性定理的通用证明中确立。我们仅需在此具体模型中验证内外互换公理 AIE1 和 AIE2。验证 $\forall v(\Phi \leftrightarrow \Psi)$ 的有效性等价于验证 $⟦\Phi⟧_g = ⟦\Psi⟧_g$ 对任意赋值 $g$ 成立。

令 $g$ 为任意变量赋值，使得 $g(P) = p_{c_P, 2}$，$g(Q) = p_{c_Q, 2}$，$g(x) = d_x$, $g(y) = d_y$, $g(z) = d_z$，其中所有 $c$ 和 $d$ 变量均取值于 $\{0, 1\}$。

*   **验证 AIE1: $Q(P(x, y), z) \leftrightarrow P(Q(x, y),z)$**
    *   LHS: $⟦Q(P(x, y), z)⟧_g = p_{c_Q, 2}(p_{c_P, 2}(d_x, d_y), d_z) = c_Q \wedge (c_P \wedge d_x \wedge d_y) \wedge d_z$
    *   RHS: $⟦P(Q(x, y), z)⟧_g = p_{c_P, 2}(p_{c_Q, 2}(d_x, d_y), d_z) = c_P \wedge (c_Q \wedge d_x \wedge d_y) \wedge d_z$
    由于逻辑与 `∧` 满足结合律和交换律，LHS = RHS。

*   **验证 AIE2: $Q(x, P(y, z)) \leftrightarrow P(x, Q(y, z))$**
    *   LHS: $⟦Q(x, P(y, z))⟧_g = p_{c_Q, 2}(d_x, p_{c_P, 2}(d_y, d_z)) = c_Q \wedge d_x \wedge (c_P \wedge d_y \wedge d_z)$
    *   RHS: $⟦P(x, Q(y, z))⟧_g = p_{c_P, 2}(d_x, p_{c_Q, 2}(d_y, d_z)) = c_P \wedge d_x \wedge (c_Q \wedge d_y \wedge d_z)$
    由于逻辑与 `∧` 满足结合律和交换律，LHS = RHS。

此模型 $\mathcal{M}_C$ 满足系统 $L_I$ 的所有公理。由于存在一个 $L_I$ 的模型，根据可靠性定理，任何可证的公式在该模型中都必须为真（取值为 1）。因为公式 $\perp$（即 $P \wedge \neg P$ 的任意实例）在该模型中恒为假（取值为 0），所以 $\perp$ 在 $L_I$ 中是不可证的。因此，系统 $L_I$ 是一致的。
## 有向标签同余系统

### 1. 语法定义 (Syntax)

设 $\mathcal{T}$ 为项（Terms）的集合。项的归纳定义如下：
$$ t ::= a, b, c, \dots \mid t \to t \mid t \otimes t \mid t \cong t $$
其中 $a, b, \dots$ 为原子项。$\to$表示有向边，$\otimes$表示给连通分支打标签，$\cong$表示判断。

### 2. 公理和推理规则 (Axiom & Inference Rules)

#### 2.1 模块 A

*   **Refl (自反律)**:
    $$ \frac{}{a \cong a} $$
    
*   **Id-Intro (算子自反律)**:
    $$ \frac{}{a \to a} \quad \text{以及} \quad \frac{}{a \otimes a} $$

*   **Symm (对称律)**:
    $$ \frac{a \cong b}{b \cong a} $$
*   **Trans (传递律)**:
    $$ \frac{a \cong b, \quad b \cong c}{a \cong c} $$

#### 2.2 模块 B

*   **Rule B1:**
    $$ \frac{a \to b, \quad b \otimes c}{a \to (b \otimes c)} $$

*   **Rule B2:**
    $$ \frac{a \to b, \quad a \otimes c}{(a \to b) \otimes c} $$

*   **Rule B3:**
    $$ \frac{(a \otimes b) \to c, \quad b \otimes d}{(b \otimes d) \to c} $$
规则组B实际上描述了一个有向边和超边的互动：有向边来源位置上的对象被打标签，整个有向边也被打标签，有向边目标位置上的打标签行为提升为有向边的目标，而有向边来源位置上的打标签行为可以随着标签的链进行传递。
#### 2.3 模块 C

*   **Rule C1:**
    $$ \frac{a \cong b, \quad a \to c, \quad b \to d}{(a \to c) \cong (b \to d)} $$

*   **Rule C2:**
    $$ \frac{a \cong b, \quad a \otimes c, \quad b \otimes d}{(a \otimes c) \cong (b \otimes d)} $$

#### 2.4 模块 D

*   **Rule D1:**
    $$ \frac{(a \cong b) \to c}{a \to c} \quad \text{以及} \quad \frac{(a \cong b) \to c}{b \to c} $$

*   **Rule D2:**
    $$ \frac{a \otimes b, \quad a \cong c}{(a \cong c) \otimes b} $$
规则组D表示等价判断在标签结构中的抽象是保持的，等价判断在有向边结构中可以具体化。

### 3. 形式模型定义 (Formal Model Definition)

为了赋予上述语法和推理规则严谨的数学意义，我们基于分层累积结构构建一个**项模型（Term Model）**。

#### 3.1 全域的分层构造 (Stratified Construction of the Universe)

设 $\mathbb{A} = \{a, b, c, \dots\}$ 为可数无限的原子集合。我们定义全域 $\mathcal{U}$ 为一系列集合序列 $(U_n)_{n \in \mathbb{N}}$ 的归纳极限。构造过程严格遵循“点—有向边—超边”的交替迭代逻辑。

**定义构造算子 (Construction Operators):**
为了在 ZFC 集合论框架下保证严格的互斥性，我们将算子定义为带标签的笛卡尔积。设 $\mathbb{A}$ 为一族互不相同的 Urelements（或在此语境下不包含有序对的纯集合）。
定义标签集合 $L = \{0, 1, 2\}$。
*   $Op_{\to}(S) = \{0\} \times S \times S$。其中的元素 $\langle 0, x, y \rangle$ 记作 $x \to y$。
*   $Op_{\otimes}(S) = \{1\} \times S \times S$。其中的元素 $\langle 1, x, y \rangle$ 记作 $x \otimes y$。
*   $Op_{\cong}(S) = \{2\} \times S \times S$。其中的元素 $\langle 2, x, y \rangle$ 记作 $x \cong y$。

**全域的分层构造:**
定义序列 $(U_n)_{n \in \mathbb{N}}$ 如下：
*   $U_0 = \mathbb{A}$
*   对于 $n \ge 0$，令 $U_{n+1} = U_n \cup Op_{\to}(U_n) \cup Op_{\otimes}(U_n) \cup Op_{\cong}(U_n)$

**定义全域 (Universe):**
$$ \mathcal{U} = \bigcup_{n=0}^{\infty} U_n $$


**性质 3.1.1 (结构互斥性 / Structural Disjointness):**
对于全域 $\mathcal{U} = \bigcup_{n=0}^{\infty} U_n$ 中的任意元素 $t$，根据集合论的有序对定义（如 Kuratowski 定义），$t$ 具有唯一的结构类型。具体而言，定义类型函数 $\text{Type}: \mathcal{U} \to \{\text{Atom}, \text{Arrow}, \text{Tensor}, \text{Congruence}\}$：
$$
\text{Type}(t) = \begin{cases} 
\text{Atom} & \text{if } t \in \mathbb{A} \\
\text{Arrow} & \text{if } t = \langle 0, x, y \rangle \in Op_{\to}(\mathcal{U}) \\
\text{Tensor} & \text{if } t = \langle 1, x, y \rangle \in Op_{\otimes}(\mathcal{U}) \\
\text{Congruence} & \text{if } t = \langle 2, x, y \rangle \in Op_{\cong}(\mathcal{U})
\end{cases}
$$
由于 $0, 1, 2$ 互不相同，且 $\mathbb{A}$ 中元素不是以 $0,1,2$ 为首项的三元组，上述类型划分构成 $\mathcal{U}$ 的一个划分（Partition）。特别地，$\mathbb{A} \cap Op_{\cong}(\mathcal{U}) = \emptyset$ 且 $Op_{\to}(\mathcal{U}) \cap Op_{\cong}(\mathcal{U}) = \emptyset$。


#### 3.2 语义解释与真值集 (Semantic Interpretation & Truth Set)

我们将模型定义为全域的一个特定子集 $\mathcal{T} \subseteq \mathcal{U}$。$\mathcal{T}$ 被定义为算子 $\Psi$ 的最小不动点。

定义算子 $\Psi: \mathcal{P}(\mathcal{U}) \to \mathcal{P}(\mathcal{U})$。对于任意 $S \subseteq \mathcal{U}$，$\Psi(S)$ 包含 $S$ 以及满足以下闭包条件的所有 $t \in \mathcal{U}$：

1.  **无条件公理 (Unconditional Axioms):**
    *   对于任意 $x \in \mathcal{U}$，$(x \cong x) \in \Psi(S)$。
    *   对于任意 $x \in \mathcal{U}$，$(x \to x) \in \Psi(S)$ 且 $(x \otimes x) \in \Psi(S)$。
2.  **模块 A (Equivalence Closure):**
    *   若 $(x \cong y) \in S$，则 $(y \cong x) \in \Psi(S)$。
    *   若 $(x \cong y) \in S \land (y \cong z) \in S$，则 $(x \cong z) \in \Psi(S)$。
3.  **模块 B (Construction):**
    *   若 $(a \to b) \in S \land (b \otimes c) \in S$，则 $(a \to (b \otimes c)) \in \Psi(S)$。
    *   若 $(a \to b) \in S \land (a \otimes c) \in S$，则 $((a \to b) \otimes c) \in \Psi(S)$。
    *   若 $((a \otimes b) \to c) \in S \land (b \otimes d) \in S$，则 $((b \otimes d) \to c) \in \Psi(S)$。
4.  **模块 C (Congruence):**
    *   若 $(a \cong b) \in S \land (a \to c) \in S \land (b \to d) \in S$，则 $((a \to c) \cong (b \to d)) \in \Psi(S)$。
    *   若 $(a \cong b) \in S \land (a \otimes c) \in S \land (b \otimes d) \in S$，则 $((a \otimes c) \cong (b \otimes d)) \in \Psi(S)$。
5.  **模块 D (Injection/Reduction):**
    *   若 $((a \cong b) \to c) \in S$，则 $(a \to c) \in \Psi(S)$ 且 $(b \to c) \in \Psi(S)$。
    *   若 $(a \otimes b) \in S \land (a \cong c) \in S$，则 $((a \cong c) \otimes b) \in \Psi(S)$。

**引理 3.2.1 (算子单调性):**
算子 $\Psi: \mathcal{P}(\mathcal{U}) \to \mathcal{P}(\mathcal{U})$ 是单调的。即对于任意 $S_1 \subseteq S_2 \subseteq \mathcal{U}$，有 $\Psi(S_1) \subseteq \Psi(S_2)$。
*证明：* $\Psi$ 的定义仅包含恒等公理（不依赖 $S$）和基于 Horn 子句形式的推理规则（前提在 $S$ 中，结论在 $\Psi(S)$ 中）。由于前件条件的成员关系对于集合包含是保真的，故 $\Psi$ 单调。

**定义模型结构 $\mathfrak{M}$:**
根据 Knaster-Tarski 定理，单调算子在完全格 $\mathcal{P}(\mathcal{U})$ 上必存在最小不动点。定义真值集 $\mathcal{T}$ 为该最小不动点：
$$ \mathcal{T} = \text{lfp}(\Psi) = \bigcup_{k=0}^{\infty} \Psi^k(\emptyset) $$
模型定义为 $\mathfrak{M} = \langle \mathcal{U}, \mathcal{T} \rangle$。

**满足关系 $\vDash$：**
$$\mathfrak{M} \vDash t \iff t \in \mathcal{T}$$

---

### 4. 元理论性质 (Metatheoretical Properties)

#### 4.1 可靠性 (Soundness)

**定理 4.1 (可靠性):** 若 $\vdash t$，则 $\mathfrak{M} \vDash t$。

**证明:**
我们对推导 $\vdash t$ 的推导树深度 $h$ 进行结构归纳。

1.  **基础情况 ($h=1$):**
    推导仅由公理构成。
    *   若应用 **Refl** ($a \cong a$)：根据 $\Psi$ 定义的条件 1 (无条件公理)，$(a \cong a) \in \Psi(\emptyset) \subseteq \mathcal{T}$。
    *   若应用 **Id-Intro** ($a \to a$ 或 $a \otimes a$)：同理，根据条件 1，这些项直接属于 $\mathcal{T}$。
    故基础情况成立。

2.  **归纳步骤 ($h > 1$):**
    假设对于深度小于 $h$ 的所有推导结论均在 $\mathcal{T}$ 中成立。考察最后一步推理规则 $R$：
    $$ \frac{p_1, \dots, p_n}{c} $$
    其中 $p_1, \dots, p_n$ 的推导树深度小于 $h$。由归纳假设，$\mathfrak{M} \vDash p_i$ (即 $p_i \in \mathcal{T}$) 对所有 $i$ 成立。
    由于 $\mathcal{T}$ 是 $\Psi$ 的不动点，即 $\Psi(\mathcal{T}) = \mathcal{T}$，我们需要验证 $\Psi$ 的定义覆盖了所有推理规则。
    *   **对于模块 A (Symm, Trans):** $\Psi$ 的条件 2 直接对应这些规则。例如，若 $a \cong b \in \mathcal{T}$，由 $\Psi$ 条件 2，$(b \cong a) \in \Psi(\mathcal{T}) = \mathcal{T}$。
    *   **对于模块 B (B1-B3):** $\Psi$ 的条件 3 直接对应。
    *   **对于模块 C (C1-C2):** $\Psi$ 的条件 4 直接对应。
    *   **对于模块 D (D1-D2):** $\Psi$ 的条件 5 直接对应。
    
    因此，结论 $c \in \Psi(\mathcal{T}) = \mathcal{T}$。即 $\mathfrak{M} \vDash c$。
    证毕。

#### 4.2 结构不变量 (Structural Invariants)

为了确立系统的一致性，我们需要证明真值集 $\mathcal{T}$ 中的等价关系严格保持“原子性类型”。我们定义谓词 $P(t)$，用以形式化“原子的等价性仅限于同一原子的自反性”这一核心性质。

**定义 4.2 (原子类型守恒谓词):**
对于任意项 $t \in \mathcal{U}$，定义谓词 $P(t)$ 如下：
$$ P(t) \iff \forall x, y \in \mathcal{U}, \left( t = (x \cong y) \implies \left[ (x \in \mathbb{A} \iff y \in \mathbb{A}) \land (x \in \mathbb{A} \implies x = y) \right] \right) $$

**引理 4.3 (不变性引理):**
对于任意 $t \in \mathcal{T}$，性质 $P(t)$ 成立。


**证明:**
我们对不动点迭代序列 $S_k = \Psi^k(\emptyset)$ 进行结构归纳。
**归纳基础 ($k=0$):** $S_0 = \emptyset$，全称量词命题 $\forall t \in \emptyset, P(t)$ 真空成立。
**归纳步骤:** 假设 $\forall t' \in S_k, P(t')$ 成立。考察任意 $t \in S_{k+1} = \Psi(S_k)$。根据 $\Psi$ 的定义，分以下五种互斥情形讨论 $t$ 的来源：

1.  **情形：非同余类构造项 (Non-Congruence Construction)**
    若 $t$ 是通过 **无条件公理** 中的 $x \to x, x \otimes x$，或 **模块 B (Construction)**，或 **模块 D (Reduction)**，或 **模块 D (Injection)** 加入 $S_{k+1}$ 的。
    由构造算子定义，$t \in Op_{\to}(\mathcal{U}) \cup Op_{\otimes}(\mathcal{U})$。
    根据 **性质 3.1.1**，$\text{Type}(t) \in \{\text{Arrow}, \text{Tensor}\}$，故 $\text{Type}(t) \neq \text{Congruence}$。
    因此，$t$ 不具有 $x \cong y$ 的形式，谓词 $P(t)$ 中的蕴含式前件 $t = (x \cong y)$ 恒为假，蕴含式整体为真。

2.  **情形：自反公理 (Reflexivity)**
    若 $t = (x \cong x)$ 由无条件公理加入。
    $P(t)$ 等价于 $[(x \in \mathbb{A} \iff x \in \mathbb{A}) \land (x \in \mathbb{A} \implies x = x)]$。
    双条件与蕴含的后件均为逻辑重言式，故 $P(t)$ 成立。

3.  **情形：等价闭包 (Equivalence Closure - Module A)**
    *   **对称性:** 若 $t = (y \cong x)$ 且前提 $(x \cong y) \in S_k$。
        由归纳假设 $P(x \cong y)$ 成立，即 $(x \in \mathbb{A} \iff y \in \mathbb{A}) \land (x \in \mathbb{A} \implies x=y)$。
        这逻辑蕴含 $(y \in \mathbb{A} \iff x \in \mathbb{A}) \land (y \in \mathbb{A} \implies y=x)$。
        故 $P(y \cong x)$ 成立。
    *   **传递性:** 若 $t = (x \cong z)$ 且前提 $(x \cong y), (y \cong z) \in S_k$。
        由归纳假设：
        (i) $x \in \mathbb{A} \iff y \in \mathbb{A}$ 且 $y \in \mathbb{A} \iff z \in \mathbb{A}$ $\implies$ $x \in \mathbb{A} \iff z \in \mathbb{A}$。
        (ii) 若 $x \in \mathbb{A}$，由 (i) 得 $y \in \mathbb{A}$ 和 $z \in \mathbb{A}$。由归纳假设 $(x \in \mathbb{A} \implies x=y)$ 和 $(y \in \mathbb{A} \implies y=z)$ 可得 $x=y=z$，即 $x=z$。
        故 $P(x \cong z)$ 成立。

4.  **情形：同余律 (Congruence - Module C)**
    若 $t$ 由 **Rule C1** 生成，即 $t = (a \to c) \cong (b \to d)$。
    此处 $u = a \to c$, $v = b \to d$。
    由 **性质 3.1.1**，$\text{Type}(u) = \text{Arrow}$ 且 $\text{Type}(v) = \text{Arrow}$。
    由于 $\mathbb{A}$ 与 $Op_{\to}$ 互斥，故 $u \notin \mathbb{A}$ 且 $v \notin \mathbb{A}$。
    代入 $P(t)$ 的定义：
    - 双条件部分：$(u \in \mathbb{A} \iff v \in \mathbb{A}) \equiv (\bot \iff \bot) \equiv \top$。
    - 蕴含部分：$(u \in \mathbb{A} \implies u=v) \equiv (\bot \implies u=v) \equiv \top$。
    故 $P(t)$ 成立。
    若 $t$ 由 **Rule C2** 生成（涉及 $\otimes$），同理，因 $Op_{\otimes}$ 与 $\mathbb{A}$ 互斥，结论成立。

5.  **情形：模块 D (Rule D2) 的特殊说明**
    Rule D2 生成 $(a \cong c) \otimes b$。此项属于 $Op_{\otimes}(\mathcal{U})$，归入情形 1 处理，P(t) 真空成立。

综上所述，对于 $\Psi$ 的所有生成分支，性质 $P$ 均保持不变。由数学归纳法原理，$\forall t \in \mathcal{T}, P(t)$。

#### 4.3 一致性证明 (Proof of Consistency)

**定理 4.4 (原子一致性):**
系统是语义一致的。即对于任意两个不同的原子 $a, b \in \mathbb{A}$ ($a \neq b$)，$\nvdash a \cong b$。

**证明:**
我们采用反证法。

1.  **假设:** 存在 $a, b \in \mathbb{A}$ 且 $a \neq b$，使得 $\vdash a \cong b$。
2.  **语义映射:** 由 **定理 4.1 (可靠性)** 可知，若 $\vdash a \cong b$，则 $\mathfrak{M} \vDash a \cong b$，即 $(a \cong b) \in \mathcal{T}$。
3.  **应用不变量:** 根据 **引理 4.3 (不变性引理)**，所有 $\mathcal{T}$ 中的项均满足谓词 $P$。因此 $P(a \cong b)$ 成立。
4.  **展开谓词:**
    将 $t = (a \cong b)$ 代入 $P(t)$ 的定义：
    $$ (a \cong b) = (x \cong y) \implies \big( (x \in \mathbb{A} \iff y \in \mathbb{A}) \land (x \in \mathbb{A} \implies x = y) \big) $$
    令 $x=a, y=b$，前件真，故后件必须为真：
    $$ (a \in \mathbb{A} \iff b \in \mathbb{A}) \land (a \in \mathbb{A} \implies a = b) $$
5.  **导出矛盾:**
    已知 $a \in \mathbb{A}$ (假设)，结合蕴含式 $a \in \mathbb{A} \implies a = b$，根据分离规则 (Modus Ponens) 必然得出 $a = b$。
    这与假设 $a \neq b$ 直接矛盾。
6.  **结论:** 假设不成立，原命题得证。


### 5. 扩展系统

#### 5.1 扩展语法规则 (Module E Rules)

在原有的推理规则集（模块 A-D）之上，追加以下推理规则：

*   **Rule E1:**
    $$ \frac{a \cong b, \quad a \otimes c}{b \otimes c} $$

*   **Rule E2:**
    $$ \frac{a \cong b, \quad a \to c}{b \to c} $$

***


#### 5.2 扩展模型与不变性 (Extended Model & Invariance)

为了验证扩展系统的一致性，我们将 3.2 节定义的语义模型扩展以覆盖模块 E。

**定义 5.2.1 (扩展语义算子 $\Psi_{ext}$):**
定义算子 $\Psi_{ext}: \mathcal{P}(\mathcal{U}) \to \mathcal{P}(\mathcal{U})$。对于任意 $S \subseteq \mathcal{U}$，$\Psi_{ext}(S)$ 包含 $\Psi(S)$（即 3.2 节定义的规则 1-5 的生成结果），并额外包含满足以下规则 6 的所有项：

6.  **模块 E (Transport/Substitution):**
    *   若 $(a \cong b) \in S \land (a \otimes c) \in S$，则 $(b \otimes c) \in \Psi_{ext}(S)$。
    *   若 $(a \cong b) \in S \land (a \to c) \in S$，则 $(b \to c) \in \Psi_{ext}(S)$。

**定义 5.2.2 (扩展真值集):**
$$ \mathcal{T}_{ext} = \text{lfp}(\Psi_{ext}) = \bigcup_{k=0}^{\infty} \Psi_{ext}^k(\emptyset) $$

**引理 5.2.3 (扩展可靠性):**
若在扩展系统（模块 A-E）中 $\vdash t$，则 $t \in \mathcal{T}_{ext}$。（证明从略，由归纳构造直接可得）

**引理 5.2.5 (扩展不变性引理):**
对于任意 $t \in \mathcal{T}_{ext}$，性质 $P(t)$ 成立。此处 $P(t)$ 定义同 4.2 节。

**证明:**
证明过程与引理 4.3 相同，我们只需验证扩展算子 $\Psi_{ext}$ 中新增的规则（模块 E）是否保持性质 $P$。
设 $S_k = \Psi_{ext}^k(\emptyset)$，假设 $\forall t' \in S_k, P(t')$。考察 $t \in \Psi_{ext}(S_k)$ 中由模块 E 生成的项：

1.  **Rule E1:**
    规则结论为 $t = b \otimes c$。
    由构造定义，$t = \langle 1, b, c \rangle \in Op_{\otimes}(\mathcal{U})$。
    由 **性质 3.1.1**，$\text{Type}(t) = \text{Tensor} \neq \text{Congruence}$。
    因此 $t$ 不是形如 $x \cong y$ 的项，$P(t)$ 的前件为假，命题真空成立。

2.  **Rule E2:**
    规则结论为 $t = b \to c$。
    同理，$t \in Op_{\to}(\mathcal{U})$，$\text{Type}(t) = \text{Arrow} \neq \text{Congruence}$。
    $P(t)$ 真空成立。

由于模块 E 仅生成非同余类型的项（Arrow 或 Tensor），它们天然满足原子类型守恒谓词 $P$。结合引理 4.3 的结论，$\mathcal{T}_{ext}$ 中所有项均满足 $P$。

#### 5.3 扩展系统一致性证明 (Proof of Extended Consistency)

**定理 5.3.1 (扩展一致性):**
扩展后的形式系统是语法一致的。即：不存在两个不同的原子 $a, b \in \mathbb{A}$ ($a \neq b$)，使得 $\vdash a \cong b$。

**证明:**
1.  **假设:** 存在 $a, b \in \mathbb{A}, a \neq b$ 使得 $\vdash a \cong b$ 在扩展系统中成立。
2.  **语义映射:** 由 **引理 5.2.3**，推得 $(a \cong b) \in \mathcal{T}_{ext}$。
3.  **应用扩展不变量:** 由 **引理 5.2.5**，性质 $P(a \cong b)$ 必须成立。
4.  **逻辑推导:**
    $P(a \cong b)$ 蕴含 $(a \in \mathbb{A} \implies a = b)$。
    由于 $a$ 是原子，前提为真，故结论 $a = b$ 必须成立。
5.  **矛盾:** 这与假设 $a \neq b$ 矛盾。
6.  **结论:** 扩展系统一致。


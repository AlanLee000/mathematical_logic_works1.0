# 三角雕刻游戏

### I. 基础语言与演绎闭包定义

**定义 1.1（字母表与类型）**
设 $\mathbb{T}$ 为非空集合（类型集），$\mathbb{V}$ 为可数无限集合（变量集）。
设 $\tau: \mathbb{V} \to \mathbb{T}$ 为全函数。
设 $\mathcal{R}_\Delta \subseteq \mathbb{T}^3$ 与 $\mathcal{R}_\nabla \subseteq \mathbb{T}^3$ 为给定的三元关系。

**定义 1.2（合式公式集 $\mathcal{F}$）**
对象语言的合式公式集合 $\mathcal{F} = \mathcal{F}_\Delta \cup \mathcal{F}_\nabla$，其中：
1. $\mathcal{F}_\Delta = \{ \Delta(x, y, z) \mid x, y, z \in \mathbb{V} \land (\tau(x), \tau(y), \tau(z)) \in \mathcal{R}_\Delta \}$
2. $\mathcal{F}_\nabla = \{ \nabla(x, y, z) \mid x, y, z \in \mathbb{V} \land (\tau(x), \tau(y), \tau(z)) \in \mathcal{R}_\nabla \}$
*注：$\Delta(x,y,z)$ 与 $\nabla(x,y,z)$ 为严格有序三元组。*

**定义 1.3（全空间算子集 $\mathbf{U}$）**
定义可能存在的推理算子全集 $\mathbf{U} = \mathbf{U}_\Theta \cup \mathbf{U}_\Omega$，其中每一个算子为五元组：
1. $\mathbf{U}_\Theta = \{ (n, d_1, d_2, d_3, d_{base}) \mid n \in \mathcal{F}_\nabla \land \{d_1, d_2, d_3, d_{base}\} \subseteq \mathcal{F}_\Delta \}$
2. $\mathbf{U}_\Omega = \{ (d_b, d_1, d_2, d_3, n_{core}) \mid \{d_b, d_1, d_2, d_3\} \subseteq \mathcal{F}_\Delta \land n_{core} \in \mathcal{F}_\nabla \}$

对于任意 $e \in \mathbf{U}$，定义其关联公式集 $V(e)$ 与结论公式 $concl(e)$ 如下：
* 若 $e = (x_1, x_2, x_3, x_4, x_5) \in \mathbf{U}_\Theta$，则 $V(e) = \{x_1, x_2, x_3, x_4, x_5\}$，且 $concl(e) = x_5$。
* 若 $e = (x_1, x_2, x_3, x_4, x_5) \in \mathbf{U}_\Omega$，则 $V(e) = \{x_1, x_2, x_3, x_4, x_5\}$，且 $concl(e) = x_5$。

**定义 1.4（系统状态与转移映射）**
定义系统演绎状态为二元组 $S = \langle F, P \rangle$，其中 $F \subseteq \mathcal{F}$，且 $P \subseteq \mathbf{U}$。
初始状态 $S_0 = \langle \mathcal{A}_\Delta \cup \mathcal{A}_\nabla, \emptyset \rangle$，其中：
* $\mathcal{A}_\Delta = \{ \Delta(x, x, x) \mid x \in \mathbb{V} \land (\tau(x), \tau(x), \tau(x)) \in \mathcal{R}_\Delta \}$
* $\mathcal{A}_\nabla = \{ \nabla(x, x, x) \mid x \in \mathbb{V} \land (\tau(x), \tau(x), \tau(x)) \in \mathcal{R}_\nabla \}$

定义单调状态转移映射 $\Gamma(S) = S'$，其中 $S' = \langle F', P' \rangle$：
* $P' = P \cup \{ (n, d_1, d_2, d_3, \Delta(x,y,z)) \in \mathbf{U}_\Theta \mid n \in F \land d_1 = \Delta(a,x,y) \in F \land d_2 = \Delta(b,y,z) \in F \land d_3 = \Delta(c,z,x) \in F \land n = \nabla(a,b,c) \} \cup \{ (d_b, d_1, d_2, d_3, \nabla(a,b,c)) \in \mathbf{U}_\Omega \mid d_b = \Delta(x,y,z) \in F \land d_1 = \Delta(a,x,y) \in F \land d_2 = \Delta(b,y,z) \in F \land d_3 = \Delta(c,z,x) \in F \}$
* $F' = F \cup \{ concl(e) \mid e \in P' \} \cup \{ \Delta(y,z,x) \mid \Delta(x,y,z) \in F \} \cup \{ \nabla(y,z,x) \mid \nabla(x,y,z) \in F \}$

根据 Knaster-Tarski 定理，令最小不动点为 $S^* = \text{lfp}(\Gamma) = \langle F^*, E_\Omega \rangle$。
集合 $F^*$ 构成**全空间顶点集**，集合 $E_\Omega \subseteq \mathbf{U}$ 构成**固有超边集**。

---

### II. 超图结构与游戏配置空间

**定义 2.1（当前图结构）**
游戏的任意离散时间 $t \ge 0$ 的状态由二元组 $\mathcal{G}_t = (H_t, \rho_t)$ 描述。
1. **当前超图** $H_t = (F^*, E_t)$：
    * 边集划分：$E_t = E_{T,t} \cup E_{V,t}$。
    * 树边集 $E_{T,t} \subseteq E_\Omega$。对于 $\forall e \in E_{T,t}$，定义其类型属性 $\tau(e) = \mathbf{T}$。
    * 虚边集 $E_{V,t} \subset \mathbf{U}$，满足 $E_{V,t} \cap E_\Omega = \emptyset$。对于 $\forall e \in E_{V,t}$，定义其类型属性 $\tau(e) = \mathbf{V}$。
2. **当前基点** $\rho_t \in F^*$。初始状态设定为 $\mathcal{G}_0 = ((F^*, E_\Omega), \rho_0)$，其中 $\rho_0$ 为 $\mathcal{A}_\Delta \cup \mathcal{A}_\nabla$ 中的固定给定元素。

**定义 2.2（生成边与孤立属性）**
对于任意 $v \in F^*$ 与超边集 $E$，定义顶点 $v$ 在 $E$ 下的**固有生成边集**为 $Gen(v, E) = \{ e \in E \cap E_\Omega \mid concl(e) = v \}$。

**定义 2.3（同构目标）**
给定一个有限连通超图 $H^* = (V^*, E^*)$ 作为胜利目标。

---

### III. 约束判定系统

**定义 3.1（超图路径）**
在超图 $H_t$ 中，路径 $P$ 定义为顶点与超边的交替序列 $P = (v_0, e_1, v_1, e_2, v_2, \dots, e_k, v_k)$，满足：
1. $k \ge 1$ 且对于 $\forall i \in \{1, \dots, k\}$，有 $e_i \in E_t$ 且 $v_{i-1}, v_i \in V(e_i)$。
2. 对于 $\forall i \in \{1, \dots, k\}$，有 $v_{i-1} \neq v_i$。
定义边集合 $E(P) = \{e_1, e_2, \dots, e_k\}$，边类型序列 $\Sigma_P = (\tau(e_1), \dots, \tau(e_k))$。

**定义 3.2（路径约束谓词）**
1. **密度谓词 $\Phi_{\text{dense}}(P)$**：为真当且仅当 $\Sigma_P$ 中**不存在**形如 $(\mathbf{V}, \underbrace{\mathbf{T}, \dots, \mathbf{T}}_{n}, \mathbf{V})$ 的子序列，其中 $n \ge 2$。
2. **基点谓词 $\Phi_{\text{root}}(P, \rho_t)$**：为真当且仅当 $v_0 = \rho_t$ 或 $v_k = \rho_t$。
3. **包含谓词 $\Phi_{\text{inc}}(P, e)$**：为真当且仅当给定超边 $e \in E(P)$。

**定义 3.3（合法消除路径集 $\mathcal{R}$）**
给定状态 $\mathcal{G}_t$ 与新选定的虚边 $e_{new}$。构造临时边集 $E'_t = E_t \cup \{e_{new}\}$。
合法消除路径集定义为：
$$
\mathcal{R}(\mathcal{G}_t, e_{new}) = \{ P \mid P \text{ 是在 } (F^*, E'_t) \text{ 中的路径} \land \Phi_{\text{root}}(P, \rho_t) \land \Phi_{\text{dense}}(P) \land \Phi_{\text{inc}}(P, e_{new}) \}
$$

---

### IV. 游戏阶段与状态转移

每个时间步 $t$ 按序执行以下三个阶段。

**阶段 1：构造**
玩家指定一个超边 $e_{new} \in \mathbf{U}$，要求 $e_{new} \notin E_\Omega$。
生成中间边集 $E'_{t} = E_t \cup \{e_{new}\}$。

**阶段 2：消除**
系统计算集合 $\mathcal{R}(\mathcal{G}_t, e_{new})$。
* 若 $\mathcal{R}(\mathcal{G}_t, e_{new}) = \emptyset$，则 $E''_{t} = E'_{t}$。
* 若 $\mathcal{R}(\mathcal{G}_t, e_{new}) \neq \emptyset$，玩家必须指定一条路径 $P^* \in \mathcal{R}(\mathcal{G}_t, e_{new})$。系统执行移除操作：$E''_{t} = E'_{t} \setminus E(P^*)$。

**阶段 3：演替**
系统检查基点 $\rho_t$ 在 $E''_{t}$ 中的生成边属性。
* 若 $Gen(\rho_t, E''_{t}) = \emptyset$：
    1. 玩家指定新顶点 $v_{new} \in F^*$。
    2. 被选定的 $v_{new}$ 必须满足 $Gen(v_{new}, E''_{t}) = \emptyset$。
    3. 状态更新为：$E_{t+1} = E''_{t}$，$\rho_{t+1} = v_{new}$。
* 否则，状态更新为：$E_{t+1} = E''_{t}$，$\rho_{t+1} = \rho_t$。

---

### V. 终局判定

**定义 5.1（连通分支与同构）**
对于给定超图 $H = (V, E)$，两个顶点 $u, v \in V$ 是连通的，当且仅当存在一条从 $u$ 到 $v$ 的路径。该等价关系将 $H$ 划分为若干连通分支集合 $\text{Components}(H)$。
两个超图同构，当且仅当存在顶点集与边集上的双射，且双射严格保持顶点与边的关联关系。

**判定规则**
在时间 $t$ 结束时，若满足以下条件，则玩家获胜并终止游戏：
$$ \exists C \in \text{Components}((F^*, E_t)) \text{ 使得 } C \cong H^* $$